import{_ as pe,q as _,V as M,x as _e,r as d,S as me,o as N,c as h,b as w,d as t,w as l,N as ce,J as fe,e as S,g as C,D as ve,f as n,U as ge,t as c,av as be,ae as Ve,H as ye,E as we,a as Se}from"./index-054e2682.js";import{b as Ue,d as Pe,c as Re,u as Ce}from"./ui_automation-53e326f9.js";const Ee={class:"page-container"},Te={class:"page-header"},De={class:"card-container"},ke={class:"filter-bar"},xe={class:"pagination-container"},Oe={class:"dialog-footer"},Ne={class:"dialog-footer"},ze={key:0,class:"project-detail"},Le={key:1,class:"text-center text-gray-500"},Ie={class:"dialog-footer"},je={__name:"ProjectList",setup(Me){const E=_([]),z=_(!1),F=_(0),f=M({currentPage:1,pageSize:10}),T=_(""),D=_(""),P=_(!1),R=_(!1),G=_(null),$=_(null),B=_(null),s=M({name:"",description:"",status:"IN_PROGRESS",base_url:"",start_date:null,end_date:null}),r=M({name:"",description:"",status:"IN_PROGRESS",base_url:"",start_date:null,end_date:null}),A={name:[{required:!0,message:"请输入项目名称",trigger:"blur"},{min:2,max:200,message:"项目名称长度在 2 到 200 个字符",trigger:"blur"}],base_url:[{required:!0,message:"请输入基础URL",trigger:"blur"},{type:"url",message:"请输入有效的URL",trigger:"blur"}]},U=(o,e,u)=>u?new Date(u).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):"",q=o=>({NOT_STARTED:"warning",IN_PROGRESS:"primary",COMPLETED:"success"})[o]||"default",H=o=>({NOT_STARTED:"未开始",IN_PROGRESS:"进行中",COMPLETED:"已结束"})[o]||o,V=async()=>{z.value=!0;try{const o={page:f.currentPage,page_size:f.pageSize};T.value&&(o.search=T.value),D.value&&(o.status=D.value);const e=await Ue(o);E.value=e.data.results||e.data,F.value=e.data.count||E.value.length}catch(o){S.error("获取项目列表失败"),console.error("获取项目列表失败:",o)}finally{z.value=!1}},X=()=>{f.currentPage=1,V()},Y=()=>{f.currentPage=1,V()},Z=o=>{f.pageSize=o,V()},ee=o=>{f.currentPage=o,V()},k=_(!1),i=_(null),J=o=>{const e=E.value.find(u=>u.id===o);e?(i.value=e,k.value=!0):S.error("未找到项目信息")},te=o=>{B.value=o.id,Object.assign(r,{name:o.name,description:o.description,status:o.status,base_url:o.base_url,start_date:o.start_date?new Date(o.start_date):null,end_date:o.end_date?new Date(o.end_date):null}),R.value=!0},le=async o=>{try{await we.confirm("确定要删除这个项目吗？删除后数据将无法恢复。","确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await Pe(o),S.success("项目删除成功"),V()}catch(e){if(e==="cancel")return;S.error("项目删除失败"),console.error("删除项目失败:",e)}},x=o=>o?new Date(o).toISOString().split("T")[0]:null,ae=async()=>{var e;if(await G.value.validate())try{const u=Se();(e=u.user)!=null&&e.id||await u.fetchProfile();const m={...s,owner:u.user.id,start_date:x(s.start_date),end_date:x(s.end_date)};await Re(m),S.success("项目创建成功"),P.value=!1,Object.keys(s).forEach(v=>{s[v]=""}),s.status="IN_PROGRESS",V()}catch(u){S.error("项目创建失败"),console.error("创建项目失败:",u)}},oe=async()=>{if(await $.value.validate())try{const e={...r,start_date:x(r.start_date),end_date:x(r.end_date)};await Ce(B.value,e),S.success("项目更新成功"),R.value=!1,V()}catch(e){S.error("项目更新失败"),console.error("更新项目失败:",e)}};return _e(()=>{V()}),(o,e)=>{const u=d("el-icon"),m=d("el-button"),v=d("el-input"),K=d("el-col"),g=d("el-option"),L=d("el-select"),ne=d("el-row"),se=d("el-link"),y=d("el-table-column"),Q=d("el-tag"),de=d("el-table"),re=d("el-pagination"),p=d("el-form-item"),O=d("el-date-picker"),W=d("el-form"),I=d("el-dialog"),b=d("el-descriptions-item"),ue=d("el-descriptions"),ie=me("loading");return N(),h("div",Ee,[w("div",Te,[e[24]||(e[24]=w("h1",{class:"page-title"},"UI自动化项目",-1)),t(m,{type:"primary",onClick:e[0]||(e[0]=a=>P.value=!0)},{default:l(()=>[t(u,null,{default:l(()=>[t(C(ve))]),_:1}),e[23]||(e[23]=n(" 新建项目 ",-1))]),_:1,__:[23]})]),w("div",De,[w("div",ke,[t(ne,{gutter:20},{default:l(()=>[t(K,{span:6},{default:l(()=>[t(v,{modelValue:T.value,"onUpdate:modelValue":e[1]||(e[1]=a=>T.value=a),placeholder:"搜索项目名称",clearable:"",onInput:X},{prefix:l(()=>[t(u,null,{default:l(()=>[t(C(ge))]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(K,{span:4},{default:l(()=>[t(L,{modelValue:D.value,"onUpdate:modelValue":e[2]||(e[2]=a=>D.value=a),placeholder:"状态筛选",clearable:"",onChange:Y},{default:l(()=>[t(g,{label:"未开始",value:"NOT_STARTED"}),t(g,{label:"进行中",value:"IN_PROGRESS"}),t(g,{label:"已结束",value:"COMPLETED"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),ce((N(),fe(de,{data:E.value,style:{width:"100%"}},{default:l(()=>[t(y,{prop:"name",label:"项目名称","min-width":"200"},{default:l(({row:a})=>[t(se,{onClick:j=>J(a.id),type:"primary"},{default:l(()=>[n(c(a.name),1)]),_:2},1032,["onClick"])]),_:1}),t(y,{prop:"description",label:"描述","min-width":"300","show-overflow-tooltip":""}),t(y,{prop:"status",label:"状态",width:"100"},{default:l(({row:a})=>[t(Q,{type:q(a.status)},{default:l(()=>[n(c(H(a.status)),1)]),_:2},1032,["type"])]),_:1}),t(y,{prop:"base_url",label:"基础URL","min-width":"200","show-overflow-tooltip":""}),t(y,{prop:"owner.username",label:"负责人",width:"100"}),t(y,{prop:"created_at",label:"创建时间",width:"180",formatter:U}),t(y,{prop:"updated_at",label:"更新时间",width:"180",formatter:U}),t(y,{label:"操作",width:"180",fixed:"right"},{default:l(({row:a})=>[t(m,{size:"small",type:"primary",onClick:j=>J(a.id)},{default:l(()=>[t(u,null,{default:l(()=>[t(C(be))]),_:1}),e[25]||(e[25]=n(" 查看 ",-1))]),_:2,__:[25]},1032,["onClick"]),t(m,{size:"small",onClick:j=>te(a)},{default:l(()=>[t(u,null,{default:l(()=>[t(C(Ve))]),_:1}),e[26]||(e[26]=n(" 编辑 ",-1))]),_:2,__:[26]},1032,["onClick"]),t(m,{size:"small",type:"danger",onClick:j=>le(a.id)},{default:l(()=>[t(u,null,{default:l(()=>[t(C(ye))]),_:1}),e[27]||(e[27]=n(" 删除 ",-1))]),_:2,__:[27]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[ie,z.value]]),w("div",xe,[t(re,{"current-page":f.currentPage,"onUpdate:currentPage":e[3]||(e[3]=a=>f.currentPage=a),"page-size":f.pageSize,"onUpdate:pageSize":e[4]||(e[4]=a=>f.pageSize=a),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:F.value,onSizeChange:Z,onCurrentChange:ee},null,8,["current-page","page-size","total"])])]),t(I,{modelValue:P.value,"onUpdate:modelValue":e[12]||(e[12]=a=>P.value=a),title:"新建UI自动化项目",width:"500px"},{footer:l(()=>[w("span",Oe,[t(m,{onClick:e[11]||(e[11]=a=>P.value=!1)},{default:l(()=>e[28]||(e[28]=[n("取消",-1)])),_:1,__:[28]}),t(m,{type:"primary",onClick:ae},{default:l(()=>e[29]||(e[29]=[n("确定",-1)])),_:1,__:[29]})])]),default:l(()=>[t(W,{ref_key:"createFormRef",ref:G,model:s,rules:A,"label-width":"80px"},{default:l(()=>[t(p,{label:"项目名称",prop:"name"},{default:l(()=>[t(v,{modelValue:s.name,"onUpdate:modelValue":e[5]||(e[5]=a=>s.name=a),placeholder:"请输入项目名称"},null,8,["modelValue"])]),_:1}),t(p,{label:"项目描述",prop:"description"},{default:l(()=>[t(v,{modelValue:s.description,"onUpdate:modelValue":e[6]||(e[6]=a=>s.description=a),type:"textarea",placeholder:"请输入项目描述"},null,8,["modelValue"])]),_:1}),t(p,{label:"状态",prop:"status"},{default:l(()=>[t(L,{modelValue:s.status,"onUpdate:modelValue":e[7]||(e[7]=a=>s.status=a),placeholder:"请选择项目状态"},{default:l(()=>[t(g,{label:"未开始",value:"NOT_STARTED"}),t(g,{label:"进行中",value:"IN_PROGRESS"}),t(g,{label:"已结束",value:"COMPLETED"})]),_:1},8,["modelValue"])]),_:1}),t(p,{label:"基础URL",prop:"base_url"},{default:l(()=>[t(v,{modelValue:s.base_url,"onUpdate:modelValue":e[8]||(e[8]=a=>s.base_url=a),placeholder:"请输入基础URL"},null,8,["modelValue"])]),_:1}),t(p,{label:"开始日期",prop:"start_date"},{default:l(()=>[t(O,{modelValue:s.start_date,"onUpdate:modelValue":e[9]||(e[9]=a=>s.start_date=a),type:"date",placeholder:"选择日期"},null,8,["modelValue"])]),_:1}),t(p,{label:"结束日期",prop:"end_date"},{default:l(()=>[t(O,{modelValue:s.end_date,"onUpdate:modelValue":e[10]||(e[10]=a=>s.end_date=a),type:"date",placeholder:"选择日期"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),t(I,{modelValue:R.value,"onUpdate:modelValue":e[20]||(e[20]=a=>R.value=a),title:"编辑UI自动化项目",width:"500px"},{footer:l(()=>[w("span",Ne,[t(m,{onClick:e[19]||(e[19]=a=>R.value=!1)},{default:l(()=>e[30]||(e[30]=[n("取消",-1)])),_:1,__:[30]}),t(m,{type:"primary",onClick:oe},{default:l(()=>e[31]||(e[31]=[n("确定",-1)])),_:1,__:[31]})])]),default:l(()=>[t(W,{ref_key:"editFormRef",ref:$,model:r,rules:A,"label-width":"80px"},{default:l(()=>[t(p,{label:"项目名称",prop:"name"},{default:l(()=>[t(v,{modelValue:r.name,"onUpdate:modelValue":e[13]||(e[13]=a=>r.name=a),placeholder:"请输入项目名称"},null,8,["modelValue"])]),_:1}),t(p,{label:"项目描述",prop:"description"},{default:l(()=>[t(v,{modelValue:r.description,"onUpdate:modelValue":e[14]||(e[14]=a=>r.description=a),type:"textarea",placeholder:"请输入项目描述"},null,8,["modelValue"])]),_:1}),t(p,{label:"状态",prop:"status"},{default:l(()=>[t(L,{modelValue:r.status,"onUpdate:modelValue":e[15]||(e[15]=a=>r.status=a),placeholder:"请选择项目状态"},{default:l(()=>[t(g,{label:"未开始",value:"NOT_STARTED"}),t(g,{label:"进行中",value:"IN_PROGRESS"}),t(g,{label:"已结束",value:"COMPLETED"})]),_:1},8,["modelValue"])]),_:1}),t(p,{label:"基础URL",prop:"base_url"},{default:l(()=>[t(v,{modelValue:r.base_url,"onUpdate:modelValue":e[16]||(e[16]=a=>r.base_url=a),placeholder:"请输入基础URL"},null,8,["modelValue"])]),_:1}),t(p,{label:"开始日期",prop:"start_date"},{default:l(()=>[t(O,{modelValue:r.start_date,"onUpdate:modelValue":e[17]||(e[17]=a=>r.start_date=a),type:"date",placeholder:"选择日期"},null,8,["modelValue"])]),_:1}),t(p,{label:"结束日期",prop:"end_date"},{default:l(()=>[t(O,{modelValue:r.end_date,"onUpdate:modelValue":e[18]||(e[18]=a=>r.end_date=a),type:"date",placeholder:"选择日期"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),t(I,{modelValue:k.value,"onUpdate:modelValue":e[22]||(e[22]=a=>k.value=a),title:"项目详情",width:"600px"},{footer:l(()=>[w("span",Ie,[t(m,{onClick:e[21]||(e[21]=a=>k.value=!1)},{default:l(()=>e[32]||(e[32]=[n("关闭",-1)])),_:1,__:[32]})])]),default:l(()=>[i.value?(N(),h("div",ze,[t(ue,{bordered:"",column:"1"},{default:l(()=>[t(b,{label:"项目名称"},{default:l(()=>[n(c(i.value.name),1)]),_:1}),t(b,{label:"项目描述",span:2},{default:l(()=>[n(c(i.value.description||"暂无描述"),1)]),_:1}),t(b,{label:"项目状态"},{default:l(()=>[t(Q,{type:q(i.value.status)},{default:l(()=>[n(c(H(i.value.status)),1)]),_:1},8,["type"])]),_:1}),t(b,{label:"基础URL"},{default:l(()=>[n(c(i.value.base_url),1)]),_:1}),t(b,{label:"负责人"},{default:l(()=>{var a;return[n(c(((a=i.value.owner)==null?void 0:a.username)||"暂无"),1)]}),_:1}),t(b,{label:"开始日期"},{default:l(()=>[n(c(i.value.start_date?U(null,null,i.value.start_date):"未设置"),1)]),_:1}),t(b,{label:"结束日期"},{default:l(()=>[n(c(i.value.end_date?U(null,null,i.value.end_date):"未设置"),1)]),_:1}),t(b,{label:"创建时间"},{default:l(()=>[n(c(U(null,null,i.value.created_at)),1)]),_:1}),t(b,{label:"更新时间"},{default:l(()=>[n(c(U(null,null,i.value.updated_at)),1)]),_:1})]),_:1})])):(N(),h("div",Le," 加载中... "))]),_:1},8,["modelValue"])])}}},Ge=pe(je,[["__scopeId","data-v-71916ab9"]]);export{Ge as default};
