import{Q as L,u as Q,q as m,V as S,x as z,r as i,o as d,c as _,b as $,d as e,w as o,C as v,e as f,F as N,y as T,J as P,f as R}from"./index-054e2682.js";const G={class:"page-container"},H={key:0,class:"card-container"},K={key:1,class:"card-container"},X={__name:"TestCaseEdit",setup(O){const V=L(),k=Q(),g=m(),j=m(!0),y=m(!1),C=m([]),b=m([]),t=S({title:"",description:"",project_id:null,priority:"medium",test_type:"functional",status:"draft",preconditions:"",steps:"",expected_result:"",version_ids:[]}),q={title:[{required:!0,message:"请输入用例标题",trigger:"blur"},{min:5,max:500,message:"标题长度在 5 到 500 个字符",trigger:"blur"}],expected_result:[{required:!0,message:"请输入预期结果",trigger:"blur"}],steps:[{max:1e3,message:"操作步骤不能超过1000个字符",trigger:"blur"}]},w=r=>r?r.replace(/<br\s*\/?>/gi,`
`):"",x=r=>r?r.replace(/\n/g,"<br>"):"",E=async()=>{try{const r=await v.get("/projects/list/");C.value=r.data.results||[]}catch{f.error("获取项目列表失败")}},U=async r=>{if(!r){b.value=[];return}try{const l=await v.get(`/versions/projects/${r}/versions/`);b.value=l.data||[]}catch(l){console.error("获取项目版本失败:",l),f.error("获取项目版本失败"),b.value=[]}},F=r=>{t.version_ids=[],U(r)},M=()=>{},A=async()=>{var r;try{const s=(await v.get(`/testcases/${V.params.id}/`)).data;t.title=s.title,t.description=s.description,t.project_id=((r=s.project)==null?void 0:r.id)||null,t.priority=s.priority,t.test_type=s.test_type,t.status=s.status,t.preconditions=w(s.preconditions||""),t.expected_result=w(s.expected_result||""),t.steps=w(s.steps||""),t.version_ids=s.versions?s.versions.map(u=>u.id):[],t.project_id&&await U(t.project_id),j.value=!1}catch{f.error("获取用例详情失败"),k.back()}},D=async()=>{g.value&&await g.value.validate(async r=>{if(r){y.value=!0;try{const l={...t,preconditions:x(t.preconditions||""),steps:x(t.steps||""),expected_result:x(t.expected_result||"")};await v.put(`/testcases/${V.params.id}/`,l),f.success("测试用例修改成功"),k.push(`/ai-generation/testcases/${V.params.id}`)}catch(l){f.error("测试用例修改失败"),console.error("提交错误:",l)}finally{y.value=!1}}})};return z(async()=>{await E(),await A()}),(r,l)=>{const s=i("el-input"),u=i("el-form-item"),n=i("el-option"),p=i("el-select"),c=i("el-col"),h=i("el-row"),B=i("el-button"),I=i("el-form"),J=i("el-skeleton");return d(),_("div",G,[l[13]||(l[13]=$("div",{class:"page-header"},[$("h1",{class:"page-title"},"编辑测试用例")],-1)),j.value?(d(),_("div",K,[e(J,{rows:10,animated:""})])):(d(),_("div",H,[e(I,{ref_key:"formRef",ref:g,model:t,rules:q,"label-width":"100px"},{default:o(()=>[e(u,{label:"用例标题",prop:"title"},{default:o(()=>[e(s,{modelValue:t.title,"onUpdate:modelValue":l[0]||(l[0]=a=>t.title=a),placeholder:"请输入测试用例标题"},null,8,["modelValue"])]),_:1}),e(u,{label:"用例描述",prop:"description"},{default:o(()=>[e(s,{modelValue:t.description,"onUpdate:modelValue":l[1]||(l[1]=a=>t.description=a),type:"textarea",rows:4,placeholder:"请输入用例描述"},null,8,["modelValue"])]),_:1}),e(h,{gutter:20},{default:o(()=>[e(c,{span:8},{default:o(()=>[e(u,{label:"归属项目",prop:"project_id"},{default:o(()=>[e(p,{modelValue:t.project_id,"onUpdate:modelValue":l[2]||(l[2]=a=>t.project_id=a),placeholder:"请选择项目",clearable:"",filterable:"",onChange:F},{default:o(()=>[(d(!0),_(N,null,T(C.value,a=>(d(),P(n,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(c,{span:8},{default:o(()=>[e(u,{label:"优先级",prop:"priority"},{default:o(()=>[e(p,{modelValue:t.priority,"onUpdate:modelValue":l[3]||(l[3]=a=>t.priority=a),placeholder:"请选择优先级"},{default:o(()=>[e(n,{label:"低",value:"low"}),e(n,{label:"中",value:"medium"}),e(n,{label:"高",value:"high"}),e(n,{label:"紧急",value:"critical"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(c,{span:8},{default:o(()=>[e(u,{label:"测试类型",prop:"test_type"},{default:o(()=>[e(p,{modelValue:t.test_type,"onUpdate:modelValue":l[4]||(l[4]=a=>t.test_type=a),placeholder:"请选择测试类型"},{default:o(()=>[e(n,{label:"功能测试",value:"functional"}),e(n,{label:"集成测试",value:"integration"}),e(n,{label:"API测试",value:"api"}),e(n,{label:"UI测试",value:"ui"}),e(n,{label:"性能测试",value:"performance"}),e(n,{label:"安全测试",value:"security"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(h,{gutter:20},{default:o(()=>[e(c,{span:12},{default:o(()=>[e(u,{label:"状态",prop:"status"},{default:o(()=>[e(p,{modelValue:t.status,"onUpdate:modelValue":l[5]||(l[5]=a=>t.status=a),placeholder:"请选择状态"},{default:o(()=>[e(n,{label:"草稿",value:"draft"}),e(n,{label:"激活",value:"active"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(c,{span:12},{default:o(()=>[e(u,{label:"关联版本"},{default:o(()=>[e(p,{modelValue:t.version_ids,"onUpdate:modelValue":l[6]||(l[6]=a=>t.version_ids=a),placeholder:"请选择版本（可多选）",multiple:"",clearable:"",filterable:"",onChange:M},{default:o(()=>[(d(!0),_(N,null,T(b.value,a=>(d(),P(n,{key:a.id,label:a.name+(a.is_baseline?" (基线)":""),value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(u,{label:"前置条件",prop:"preconditions"},{default:o(()=>[e(s,{modelValue:t.preconditions,"onUpdate:modelValue":l[7]||(l[7]=a=>t.preconditions=a),type:"textarea",rows:3,placeholder:"请输入前置条件"},null,8,["modelValue"])]),_:1}),e(u,{label:"操作步骤",prop:"steps"},{default:o(()=>[e(s,{modelValue:t.steps,"onUpdate:modelValue":l[8]||(l[8]=a=>t.steps=a),type:"textarea",rows:6,maxlength:"1000","show-word-limit":"",placeholder:`请输入详细的操作步骤，如：
1. 打开登录页面
2. 输入用户名和密码
3. 点击登录按钮
4. 验证登录结果`},null,8,["modelValue"])]),_:1}),e(u,{label:"预期结果",prop:"expected_result"},{default:o(()=>[e(s,{modelValue:t.expected_result,"onUpdate:modelValue":l[9]||(l[9]=a=>t.expected_result=a),type:"textarea",rows:3,placeholder:"请输入整体预期结果"},null,8,["modelValue"])]),_:1}),e(u,null,{default:o(()=>[e(B,{type:"primary",onClick:D,loading:y.value},{default:o(()=>l[11]||(l[11]=[R(" 保存修改 ",-1)])),_:1,__:[11]},8,["loading"]),e(B,{onClick:l[10]||(l[10]=a=>r.$router.back())},{default:o(()=>l[12]||(l[12]=[R("取消",-1)])),_:1,__:[12]})]),_:1})]),_:1},8,["model"])]))])}}};export{X as default};
