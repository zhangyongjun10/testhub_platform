import{_ as X,q as d,V as B,x as Y,r,o as i,c as _,b as s,d as l,w as t,e as u,F as E,y as N,J as I,g,af as ee,f as C,cN as le,B as te,cO as ae,t as U,L as R,G as se,cP as oe,a3 as ne,M as ie}from"./index-644940f8.js";import{b as re,Z as de,_ as ue,$ as ce,a0 as pe}from"./ui_automation-3c95efdb.js";const _e={class:"page-container"},ve={class:"page-header"},fe={class:"card-container"},me={key:0,class:"empty-logs"},ge={key:1,class:"log-content"},ye={class:"task-list-container"},ke={key:0,class:"analyzing-state"},be={key:1},we={class:"task-status-icon"},xe={class:"task-content"},Ve={class:"task-id"},Ie={class:"task-desc"},Ce={key:2,class:"empty-tasks"},Ae={class:"dialog-footer"},he={__name:"AITesting",setup(Fe){const A=d([]),v=d(""),f=d(!1),y=d(!1),T=d(!1),h=d(""),k=d([]),b=d(null),F=d(null),c=B({description:"",enableGif:!0}),w=d(!1),p=B({name:"",description:""}),G=d(null),D={name:[{required:!0,message:"请输入用例名称",trigger:"blur"}]},P=async()=>{try{const o=await re({page_size:100});A.value=o.data.results||o.data,A.value.length>0&&(v.value=A.value[0].id)}catch(o){console.error("获取项目列表失败:",o),u.error("获取项目列表失败")}},q=()=>{},L=async()=>{var o,e;if(!v.value){u.warning("请先选择项目");return}f.value=!0,y.value=!0,h.value=`正在初始化 AI Agent...
`,k.value=[];try{const n=await de({project_id:v.value,task_description:c.description,execution_mode:"text",enable_gif:c.enableGif});b.value=n.data.execution_id,u.success("任务开始执行"),H()}catch(n){console.error("执行失败:",n),u.error("执行失败: "+(((e=(o=n.response)==null?void 0:o.data)==null?void 0:e.error)||n.message)),f.value=!1,y.value=!1}},M=async()=>{if(b.value)try{await ue(b.value),u.warning("正在停止任务...")}catch(o){console.error("停止失败:",o),u.error("停止失败")}},H=()=>{const o=setInterval(async()=>{if(!b.value){clearInterval(o);return}try{const n=(await ce(b.value)).data;h.value=n.logs||"",k.value=n.planned_tasks||[],k.value.length>0&&(y.value=!1),ie(()=>{F.value&&(F.value.scrollTop=F.value.scrollHeight)}),(n.status==="passed"||n.status==="failed"||n.status==="stopped")&&(clearInterval(o),f.value=!1,y.value=!1,n.status==="passed"?u.success("执行成功"):n.status==="stopped"?u.warning("任务已停止"):u.error("执行失败"))}catch(e){console.error("获取日志失败:",e)}},2e3)},$=()=>{w.value=!0,p.name="",p.description=""},J=async()=>{G.value&&await G.value.validate(async o=>{if(o){T.value=!0;try{await pe({project_id:v.value,name:p.name,description:p.description,task_description:c.description}),u.success("保存成功"),w.value=!1}catch(e){console.error("保存失败:",e),u.error("保存失败")}finally{T.value=!1}}})};return Y(()=>{P()}),(o,e)=>{const n=r("el-option"),O=r("el-select"),S=r("el-input"),x=r("el-form-item"),Z=r("el-switch"),m=r("el-icon"),V=r("el-button"),j=r("el-form"),K=r("el-alert"),z=r("el-col"),Q=r("el-row"),W=r("el-dialog");return i(),_("div",_e,[s("div",ve,[e[7]||(e[7]=s("h1",{class:"page-title"},"AI 智能测试",-1)),l(O,{modelValue:v.value,"onUpdate:modelValue":e[0]||(e[0]=a=>v.value=a),placeholder:"选择项目",style:{width:"200px","margin-right":"15px"},onChange:q},{default:t(()=>[(i(!0),_(E,null,N(A.value,a=>(i(),I(n,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),s("div",fe,[l(Q,{gutter:20},{default:t(()=>[l(z,{span:12},{default:t(()=>[e[13]||(e[13]=s("div",{class:"section-title"},"任务输入",-1)),l(j,{model:c,"label-position":"top"},{default:t(()=>[l(x,{label:"任务描述",required:""},{default:t(()=>[l(S,{modelValue:c.description,"onUpdate:modelValue":e[1]||(e[1]=a=>c.description=a),type:"textarea",rows:10,placeholder:`请用自然语言描述要执行的任务，例如：
1. 访问 https://www.baidu.com
2. 搜索 'TestHub'
3. 点击第一条搜索结果`,maxlength:"2000","show-word-limit":""},null,8,["modelValue"])]),_:1}),l(x,{label:"GIF录制"},{default:t(()=>[l(Z,{modelValue:c.enableGif,"onUpdate:modelValue":e[2]||(e[2]=a=>c.enableGif=a),"active-text":"开启","inactive-text":"关闭"},null,8,["modelValue"]),e[8]||(e[8]=s("span",{style:{"margin-left":"10px",color:"#909399","font-size":"12px"}}," 开启后将录制执行过程并生成GIF文件，保存到 ai_agent_history 目录 ",-1))]),_:1,__:[8]}),l(x,null,{default:t(()=>[l(V,{type:"primary",onClick:L,loading:f.value,disabled:!c.description||!v.value},{default:t(()=>[l(m,null,{default:t(()=>[l(g(ee))]),_:1}),e[9]||(e[9]=C(" 开始执行 ",-1))]),_:1,__:[9]},8,["loading","disabled"]),f.value?(i(),I(V,{key:0,type:"danger",onClick:M,disabled:!f.value||y.value},{default:t(()=>[l(m,null,{default:t(()=>[l(g(le))]),_:1}),e[10]||(e[10]=C(" 停止执行 ",-1))]),_:1,__:[10]},8,["disabled"])):te("",!0),l(V,{type:"success",onClick:$,disabled:!c.description||!v.value},{default:t(()=>[l(m,null,{default:t(()=>[l(g(ae))]),_:1}),e[11]||(e[11]=C(" 保存为用例 ",-1))]),_:1,__:[11]},8,["disabled"])]),_:1})]),_:1},8,["model"]),l(K,{title:"提示",type:"info",closable:!1,style:{"margin-top":"20px"}},{default:t(()=>e[12]||(e[12]=[s("div",null,"AI 模式使用 SiliconFlow 的 DeepSeek V3.2 模型，支持中英文任务描述。",-1),s("div",null,"任务描述越详细，执行效果越好。",-1)])),_:1}),e[14]||(e[14]=s("div",{class:"section-title",style:{"margin-top":"20px"}},"执行日志",-1)),s("div",{class:"log-container",ref_key:"logContainer",ref:F},[!h.value&&!f.value?(i(),_("div",me," 暂无执行日志 ")):(i(),_("pre",ge,U(h.value),1))],512)]),_:1,__:[13,14]}),l(z,{span:12},{default:t(()=>[e[16]||(e[16]=s("div",{class:"section-title"},"任务明细",-1)),s("div",ye,[y.value?(i(),_("div",ke,[l(m,{class:"is-loading"},{default:t(()=>[l(g(R))]),_:1}),e[15]||(e[15]=s("span",null,"任务分析中...",-1))])):k.value.length>0?(i(),_("div",be,[(i(!0),_(E,null,N(k.value,a=>(i(),_("div",{key:a.id,class:se(["task-item",a.status])},[s("div",we,[a.status==="completed"?(i(),I(m,{key:0,color:"#67C23A"},{default:t(()=>[l(g(oe))]),_:1})):a.status==="in_progress"?(i(),I(m,{key:1,class:"is-loading",color:"#409EFF"},{default:t(()=>[l(g(R))]),_:1})):(i(),I(m,{key:2,color:"#909399"},{default:t(()=>[l(g(ne))]),_:1}))]),s("div",xe,[s("span",Ve,U(a.id)+".",1),s("span",Ie,U(a.description),1)])],2))),128))])):(i(),_("div",Ce," 暂无任务 "))])]),_:1,__:[16]})]),_:1})]),l(W,{modelValue:w.value,"onUpdate:modelValue":e[6]||(e[6]=a=>w.value=a),title:"保存为 AI 用例",width:"500px"},{footer:t(()=>[s("span",Ae,[l(V,{onClick:e[5]||(e[5]=a=>w.value=!1)},{default:t(()=>e[17]||(e[17]=[C("取消",-1)])),_:1,__:[17]}),l(V,{type:"primary",onClick:J,loading:T.value},{default:t(()=>e[18]||(e[18]=[C("保存",-1)])),_:1,__:[18]},8,["loading"])])]),default:t(()=>[l(j,{model:p,rules:D,ref_key:"saveFormRef",ref:G,"label-width":"80px"},{default:t(()=>[l(x,{label:"用例名称",prop:"name"},{default:t(()=>[l(S,{modelValue:p.name,"onUpdate:modelValue":e[3]||(e[3]=a=>p.name=a),placeholder:"请输入用例名称"},null,8,["modelValue"])]),_:1}),l(x,{label:"描述",prop:"description"},{default:t(()=>[l(S,{modelValue:p.description,"onUpdate:modelValue":e[4]||(e[4]=a=>p.description=a),type:"textarea",placeholder:"请输入用例描述"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},Se=X(he,[["__scopeId","data-v-08fcdc5c"]]);export{Se as default};
