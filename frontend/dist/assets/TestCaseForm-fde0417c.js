import{u as M,q as f,V as T,x as A,r as u,o as m,c as V,b as g,d as e,w as a,C as y,e as _,F as C,y as k,J as j,f as h}from"./index-054e2682.js";const I={class:"page-container"},J={class:"card-container"},z={__name:"TestCaseForm",setup(L){const B=M(),b=f(),v=f(!1),x=f([]),c=f([]),o=T({title:"",description:"",project_id:null,priority:"medium",test_type:"functional",status:"draft",preconditions:"",steps:"",expected_result:"",version_ids:[]}),P={title:[{required:!0,message:"请输入用例标题",trigger:"blur"},{min:5,max:500,message:"标题长度在 5 到 500 个字符",trigger:"blur"}],expected_result:[{required:!0,message:"请输入预期结果",trigger:"blur"}],steps:[{max:1e3,message:"操作步骤不能超过1000个字符",trigger:"blur"}]},q=async()=>{try{const s=await y.get("/projects/list/");x.value=s.data.results||[]}catch{_.error("获取项目列表失败")}},F=async s=>{if(!s){c.value=[];return}try{const l=await y.get(`/versions/projects/${s}/versions/`);c.value=l.data||[]}catch(l){console.error("获取项目版本失败:",l),_.error("获取项目版本失败"),c.value=[]}},N=s=>{o.version_ids=[],F(s)},R=()=>{},$=async()=>{b.value&&await b.value.validate(async s=>{if(s){v.value=!0;try{await y.post("/testcases/",o),_.success("测试用例创建成功"),B.push("/ai-generation/testcases")}catch(l){_.error("测试用例创建失败"),console.error("提交错误:",l)}finally{v.value=!1}}})};return A(()=>{q()}),(s,l)=>{const d=u("el-input"),n=u("el-form-item"),r=u("el-option"),i=u("el-select"),p=u("el-col"),w=u("el-row"),U=u("el-button"),E=u("el-form");return m(),V("div",I,[l[13]||(l[13]=g("div",{class:"page-header"},[g("h1",{class:"page-title"},"创建测试用例")],-1)),g("div",J,[e(E,{ref_key:"formRef",ref:b,model:o,rules:P,"label-width":"100px"},{default:a(()=>[e(n,{label:"用例标题",prop:"title"},{default:a(()=>[e(d,{modelValue:o.title,"onUpdate:modelValue":l[0]||(l[0]=t=>o.title=t),placeholder:"请输入测试用例标题"},null,8,["modelValue"])]),_:1}),e(n,{label:"用例描述",prop:"description"},{default:a(()=>[e(d,{modelValue:o.description,"onUpdate:modelValue":l[1]||(l[1]=t=>o.description=t),type:"textarea",rows:4,placeholder:"请输入用例描述"},null,8,["modelValue"])]),_:1}),e(w,{gutter:20},{default:a(()=>[e(p,{span:8},{default:a(()=>[e(n,{label:"归属项目",prop:"project_id"},{default:a(()=>[e(i,{modelValue:o.project_id,"onUpdate:modelValue":l[2]||(l[2]=t=>o.project_id=t),placeholder:"请选择项目",clearable:"",filterable:"",onChange:N},{default:a(()=>[(m(!0),V(C,null,k(x.value,t=>(m(),j(r,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(p,{span:8},{default:a(()=>[e(n,{label:"优先级",prop:"priority"},{default:a(()=>[e(i,{modelValue:o.priority,"onUpdate:modelValue":l[3]||(l[3]=t=>o.priority=t),placeholder:"请选择优先级"},{default:a(()=>[e(r,{label:"低",value:"low"}),e(r,{label:"中",value:"medium"}),e(r,{label:"高",value:"high"}),e(r,{label:"紧急",value:"critical"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(p,{span:8},{default:a(()=>[e(n,{label:"测试类型",prop:"test_type"},{default:a(()=>[e(i,{modelValue:o.test_type,"onUpdate:modelValue":l[4]||(l[4]=t=>o.test_type=t),placeholder:"请选择测试类型"},{default:a(()=>[e(r,{label:"功能测试",value:"functional"}),e(r,{label:"集成测试",value:"integration"}),e(r,{label:"API测试",value:"api"}),e(r,{label:"UI测试",value:"ui"}),e(r,{label:"性能测试",value:"performance"}),e(r,{label:"安全测试",value:"security"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(w,{gutter:20},{default:a(()=>[e(p,{span:12},{default:a(()=>[e(n,{label:"状态",prop:"status"},{default:a(()=>[e(i,{modelValue:o.status,"onUpdate:modelValue":l[5]||(l[5]=t=>o.status=t),placeholder:"请选择状态"},{default:a(()=>[e(r,{label:"草稿",value:"draft"}),e(r,{label:"激活",value:"active"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(p,{span:12},{default:a(()=>[e(n,{label:"关联版本"},{default:a(()=>[e(i,{modelValue:o.version_ids,"onUpdate:modelValue":l[6]||(l[6]=t=>o.version_ids=t),placeholder:"请选择版本（可多选）",multiple:"",clearable:"",filterable:"",onChange:R},{default:a(()=>[(m(!0),V(C,null,k(c.value,t=>(m(),j(r,{key:t.id,label:t.name+(t.is_baseline?" (基线)":""),value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(n,{label:"前置条件",prop:"preconditions"},{default:a(()=>[e(d,{modelValue:o.preconditions,"onUpdate:modelValue":l[7]||(l[7]=t=>o.preconditions=t),type:"textarea",rows:3,placeholder:"请输入前置条件"},null,8,["modelValue"])]),_:1}),e(n,{label:"操作步骤",prop:"steps"},{default:a(()=>[e(d,{modelValue:o.steps,"onUpdate:modelValue":l[8]||(l[8]=t=>o.steps=t),type:"textarea",rows:6,maxlength:"1000","show-word-limit":"",placeholder:`请输入详细的操作步骤，如：
1. 打开登录页面
2. 输入用户名和密码
3. 点击登录按钮
4. 验证登录结果`},null,8,["modelValue"])]),_:1}),e(n,{label:"预期结果",prop:"expected_result"},{default:a(()=>[e(d,{modelValue:o.expected_result,"onUpdate:modelValue":l[9]||(l[9]=t=>o.expected_result=t),type:"textarea",rows:3,placeholder:"请输入整体预期结果"},null,8,["modelValue"])]),_:1}),e(n,null,{default:a(()=>[e(U,{type:"primary",onClick:$,loading:v.value},{default:a(()=>l[11]||(l[11]=[h(" 创建用例 ",-1)])),_:1,__:[11]},8,["loading"]),e(U,{onClick:l[10]||(l[10]=t=>s.$router.back())},{default:a(()=>l[12]||(l[12]=[h("取消",-1)])),_:1,__:[12]})]),_:1})]),_:1},8,["model"])])])}}};export{z as default};
