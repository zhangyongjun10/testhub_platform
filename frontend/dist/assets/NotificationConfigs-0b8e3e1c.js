import{C as R,_ as L,s as F,q as V,V as I,x as q,r as _,o as M,c as y,b as u,d as o,w as l,f as c,e as C}from"./index-054e2682.js";function W(h){return R({url:"/core/notification-configs/",method:"get",params:h})}function D(h){return R({url:"/core/notification-configs/",method:"post",data:h})}function S(h,e){return R({url:`/core/notification-configs/${h}/`,method:"put",data:e})}const E={name:"NotificationConfigs",components:{Setting:F},setup(){const h=V(null),e=V(null),B=V(null),a=V("feishu"),r=I({feishu:{name:"",webhook_url:"",enabled:!0,enable_ui_automation:!0,enable_api_testing:!0},wechat:{name:"",webhook_url:"",enabled:!0,enable_ui_automation:!0,enable_api_testing:!0},dingtalk:{name:"",webhook_url:"",secret:"",enabled:!0,enable_ui_automation:!0,enable_api_testing:!0}}),v=t=>({feishu:"webhook_feishu",wechat:"webhook_wechat",dingtalk:"webhook_dingtalk"})[t],U=async t=>{var m,f;if(t==="feishu"?h.value:t==="wechat"?e.value:B.value)try{const i=v(t);let g=null;try{const k=await W({config_type:i});k.data.results&&k.data.results.length>0&&(g=k.data.results[0].id)}catch{console.log("未找到现有Webhook配置，将创建新配置")}const d=r[t];let w;if(g){const n=(await W({config_type:i})).data.results[0],N=n.webhook_bots||{},x={name:d.name||`${t}机器人`,webhook_url:d.webhook_url,enabled:d.enabled,enable_ui_automation:d.enable_ui_automation,enable_api_testing:d.enable_api_testing};t==="dingtalk"&&d.secret&&(x.secret=d.secret),N[t]=x,w={name:n.name||`${t==="feishu"?"飞书":t==="wechat"?"企微":"钉钉"}机器人配置`,config_type:i,webhook_bots:N,is_active:!0},await S(g,w),C.success(`${t==="feishu"?"飞书":t==="wechat"?"企微":"钉钉"}机器人配置更新成功`)}else{const k={name:d.name||`${t}机器人`,webhook_url:d.webhook_url,enabled:d.enabled,enable_ui_automation:d.enable_ui_automation,enable_api_testing:d.enable_api_testing};t==="dingtalk"&&d.secret&&(k.secret=d.secret),w={name:`${t==="feishu"?"飞书":t==="wechat"?"企微":"钉钉"}机器人配置`,config_type:i,webhook_bots:{[t]:k},is_active:!0},await D(w),C.success(`${t==="feishu"?"飞书":t==="wechat"?"企微":"钉钉"}机器人配置创建成功`)}p(t)}catch(i){console.error("保存Webhook机器人配置失败:",i),C.error(`${t==="feishu"?"飞书":t==="wechat"?"企微":"钉钉"}机器人配置保存失败: `+(((f=(m=i.response)==null?void 0:m.data)==null?void 0:f.detail)||i.message))}},p=async t=>{try{const s=v(t),m=await W({config_type:s});if(m.data.results&&m.data.results.length>0){const f=m.data.results[0];if(f.webhook_bots&&f.webhook_bots[t]){const i=f.webhook_bots[t];r[t].name=i.name||"",r[t].webhook_url=i.webhook_url||"",r[t].enabled=i.enabled!==!1,r[t].enable_ui_automation=i.enable_ui_automation!==!1,r[t].enable_api_testing=i.enable_api_testing!==!1,t==="dingtalk"&&i.secret&&(r[t].secret=i.secret)}}}catch(s){console.error("获取Webhook机器人配置失败:",s)}},b=async()=>{try{for(const t of Object.keys(r))await p(t)}catch(t){console.error("获取所有Webhook机器人配置失败:",t)}};return q(async()=>{try{console.log("NotificationConfigs 组件开始初始化"),await b(),console.log("NotificationConfigs 组件初始化完成")}catch(t){console.error("NotificationConfigs 组件初始化失败:",t)}}),{feishuFormRef:h,wechatFormRef:e,dingtalkFormRef:B,activeTab:a,webhookBots:r,saveWebhookBot:U,fetchWebhookConfig:p,fetchAllWebhookConfigs:b}}},j={class:"notification-configs-container"},A={class:"page-header"},O={class:"page-title"},z={class:"content-wrapper"},G={class:"tab-content"},H={class:"config-section"},J={class:"form-actions"},K={class:"tab-content"},P={class:"config-section"},Q={class:"form-actions"},X={class:"tab-content"},Y={class:"config-section"},Z={class:"form-actions"};function T(h,e,B,a,r,v){const U=_("Setting"),p=_("el-icon"),b=_("el-input"),t=_("el-form-item"),s=_("el-col"),m=_("el-switch"),f=_("el-checkbox"),i=_("el-row"),g=_("el-button"),d=_("el-form"),w=_("el-tab-pane"),k=_("el-tabs");return M(),y("div",j,[u("div",A,[u("h1",O,[o(p,{class:"title-icon"},{default:l(()=>[o(U)]),_:1}),e[20]||(e[20]=c(" UI自动化通知配置 ",-1))]),e[21]||(e[21]=u("p",{class:"page-description"}," 配置飞书、企微、钉钉Webhook机器人地址 ",-1))]),u("div",z,[o(k,{modelValue:a.activeTab,"onUpdate:modelValue":e[19]||(e[19]=n=>a.activeTab=n),class:"notification-tabs"},{default:l(()=>[o(w,{label:"飞书机器人",name:"feishu"},{default:l(()=>[u("div",G,[u("div",H,[o(d,{ref:"feishuFormRef",model:a.webhookBots.feishu,"label-position":"top",class:"config-form"},{default:l(()=>[o(i,{gutter:20},{default:l(()=>[o(s,{span:12},{default:l(()=>[o(t,{label:"机器人名称"},{default:l(()=>[o(b,{modelValue:a.webhookBots.feishu.name,"onUpdate:modelValue":e[0]||(e[0]=n=>a.webhookBots.feishu.name=n),placeholder:"请输入飞书机器人名称"},null,8,["modelValue"])]),_:1})]),_:1}),o(s,{span:12},{default:l(()=>[o(t,{label:"启用"},{default:l(()=>[o(m,{modelValue:a.webhookBots.feishu.enabled,"onUpdate:modelValue":e[1]||(e[1]=n=>a.webhookBots.feishu.enabled=n)},null,8,["modelValue"])]),_:1})]),_:1}),o(s,{span:24},{default:l(()=>[o(t,{label:"Webhook URL"},{default:l(()=>[o(b,{modelValue:a.webhookBots.feishu.webhook_url,"onUpdate:modelValue":e[2]||(e[2]=n=>a.webhookBots.feishu.webhook_url=n),placeholder:"请输入飞书机器人Webhook URL"},null,8,["modelValue"]),e[22]||(e[22]=u("div",{class:"form-item-hint"}," 飞书机器人Webhook URL格式：https://open.feishu.cn/open-apis/bot/v2/hook/... ",-1))]),_:1,__:[22]})]),_:1}),o(s,{span:24},{default:l(()=>[o(t,{label:"业务类型"},{default:l(()=>[o(f,{modelValue:a.webhookBots.feishu.enable_ui_automation,"onUpdate:modelValue":e[3]||(e[3]=n=>a.webhookBots.feishu.enable_ui_automation=n)},{default:l(()=>e[23]||(e[23]=[c("UI自动化测试",-1)])),_:1,__:[23]},8,["modelValue"]),o(f,{modelValue:a.webhookBots.feishu.enable_api_testing,"onUpdate:modelValue":e[4]||(e[4]=n=>a.webhookBots.feishu.enable_api_testing=n)},{default:l(()=>e[24]||(e[24]=[c("接口测试",-1)])),_:1,__:[24]},8,["modelValue"])]),_:1})]),_:1})]),_:1}),u("div",J,[o(g,{type:"primary",onClick:e[5]||(e[5]=n=>a.saveWebhookBot("feishu"))},{default:l(()=>e[25]||(e[25]=[c(" 保存飞书机器人配置 ",-1)])),_:1,__:[25]})])]),_:1},8,["model"])])])]),_:1}),o(w,{label:"企微机器人",name:"wechat"},{default:l(()=>[u("div",K,[u("div",P,[o(d,{ref:"wechatFormRef",model:a.webhookBots.wechat,"label-position":"top",class:"config-form"},{default:l(()=>[o(i,{gutter:20},{default:l(()=>[o(s,{span:12},{default:l(()=>[o(t,{label:"机器人名称"},{default:l(()=>[o(b,{modelValue:a.webhookBots.wechat.name,"onUpdate:modelValue":e[6]||(e[6]=n=>a.webhookBots.wechat.name=n),placeholder:"请输入企业微信机器人名称"},null,8,["modelValue"])]),_:1})]),_:1}),o(s,{span:12},{default:l(()=>[o(t,{label:"启用"},{default:l(()=>[o(m,{modelValue:a.webhookBots.wechat.enabled,"onUpdate:modelValue":e[7]||(e[7]=n=>a.webhookBots.wechat.enabled=n)},null,8,["modelValue"])]),_:1})]),_:1}),o(s,{span:24},{default:l(()=>[o(t,{label:"Webhook URL"},{default:l(()=>[o(b,{modelValue:a.webhookBots.wechat.webhook_url,"onUpdate:modelValue":e[8]||(e[8]=n=>a.webhookBots.wechat.webhook_url=n),placeholder:"请输入企业微信机器人Webhook URL"},null,8,["modelValue"]),e[26]||(e[26]=u("div",{class:"form-item-hint"}," 企业微信机器人Webhook URL格式：https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=... ",-1))]),_:1,__:[26]})]),_:1}),o(s,{span:24},{default:l(()=>[o(t,{label:"业务类型"},{default:l(()=>[o(f,{modelValue:a.webhookBots.wechat.enable_ui_automation,"onUpdate:modelValue":e[9]||(e[9]=n=>a.webhookBots.wechat.enable_ui_automation=n)},{default:l(()=>e[27]||(e[27]=[c("UI自动化测试",-1)])),_:1,__:[27]},8,["modelValue"]),o(f,{modelValue:a.webhookBots.wechat.enable_api_testing,"onUpdate:modelValue":e[10]||(e[10]=n=>a.webhookBots.wechat.enable_api_testing=n)},{default:l(()=>e[28]||(e[28]=[c("接口测试",-1)])),_:1,__:[28]},8,["modelValue"])]),_:1})]),_:1})]),_:1}),u("div",Q,[o(g,{type:"primary",onClick:e[11]||(e[11]=n=>a.saveWebhookBot("wechat"))},{default:l(()=>e[29]||(e[29]=[c(" 保存企微机器人配置 ",-1)])),_:1,__:[29]})])]),_:1},8,["model"])])])]),_:1}),o(w,{label:"钉钉机器人",name:"dingtalk"},{default:l(()=>[u("div",X,[u("div",Y,[o(d,{ref:"dingtalkFormRef",model:a.webhookBots.dingtalk,"label-position":"top",class:"config-form"},{default:l(()=>[o(i,{gutter:20},{default:l(()=>[o(s,{span:12},{default:l(()=>[o(t,{label:"机器人名称"},{default:l(()=>[o(b,{modelValue:a.webhookBots.dingtalk.name,"onUpdate:modelValue":e[12]||(e[12]=n=>a.webhookBots.dingtalk.name=n),placeholder:"请输入钉钉机器人名称"},null,8,["modelValue"])]),_:1})]),_:1}),o(s,{span:12},{default:l(()=>[o(t,{label:"启用"},{default:l(()=>[o(m,{modelValue:a.webhookBots.dingtalk.enabled,"onUpdate:modelValue":e[13]||(e[13]=n=>a.webhookBots.dingtalk.enabled=n)},null,8,["modelValue"])]),_:1})]),_:1}),o(s,{span:24},{default:l(()=>[o(t,{label:"Webhook URL"},{default:l(()=>[o(b,{modelValue:a.webhookBots.dingtalk.webhook_url,"onUpdate:modelValue":e[14]||(e[14]=n=>a.webhookBots.dingtalk.webhook_url=n),placeholder:"请输入钉钉机器人Webhook URL"},null,8,["modelValue"]),e[30]||(e[30]=u("div",{class:"form-item-hint"}," 钉钉机器人Webhook URL格式：https://oapi.dingtalk.com/robot/send?access_token=... ",-1))]),_:1,__:[30]})]),_:1}),o(s,{span:24},{default:l(()=>[o(t,{label:"签名密钥"},{default:l(()=>[o(b,{modelValue:a.webhookBots.dingtalk.secret,"onUpdate:modelValue":e[15]||(e[15]=n=>a.webhookBots.dingtalk.secret=n),placeholder:"请输入钉钉机器人签名密钥（可选）",type:"password","show-password":""},null,8,["modelValue"]),e[31]||(e[31]=u("div",{class:"form-item-hint"},' 钉钉机器人的签名密钥，用于安全验证。如果机器人开启了"加签"安全设置，请填写此字段。 ',-1))]),_:1,__:[31]})]),_:1}),o(s,{span:24},{default:l(()=>[o(t,{label:"业务类型"},{default:l(()=>[o(f,{modelValue:a.webhookBots.dingtalk.enable_ui_automation,"onUpdate:modelValue":e[16]||(e[16]=n=>a.webhookBots.dingtalk.enable_ui_automation=n)},{default:l(()=>e[32]||(e[32]=[c("UI自动化测试",-1)])),_:1,__:[32]},8,["modelValue"]),o(f,{modelValue:a.webhookBots.dingtalk.enable_api_testing,"onUpdate:modelValue":e[17]||(e[17]=n=>a.webhookBots.dingtalk.enable_api_testing=n)},{default:l(()=>e[33]||(e[33]=[c("接口测试",-1)])),_:1,__:[33]},8,["modelValue"])]),_:1})]),_:1})]),_:1}),u("div",Z,[o(g,{type:"primary",onClick:e[18]||(e[18]=n=>a.saveWebhookBot("dingtalk"))},{default:l(()=>e[34]||(e[34]=[c(" 保存钉钉机器人配置 ",-1)])),_:1,__:[34]})])]),_:1},8,["model"])])])]),_:1})]),_:1},8,["modelValue"])])])}const ee=L(E,[["render",T],["__scopeId","data-v-23f9106d"]]);export{ee as default};
