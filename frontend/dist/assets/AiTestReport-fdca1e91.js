import{_ as W,q as i,V as J,x as X,M as H,a7 as K,r as h,o as L,c as D,b as t,d as a,w as r,t as n,C as f,e as Q,F as Y,y as Z,J as $,g as x,T as ee,f as B,a8 as te,a2 as ae,a3 as se,a9 as oe}from"./index-054e2682.js";import{i as k,L as le}from"./index-6433f102.js";const re={class:"test-report"},ce={class:"filter-bar"},ie={class:"left-filters"},ne={class:"right-actions"},de={class:"dashboard-cards"},ue={class:"card total-plans"},_e={class:"card-icon"},pe={class:"card-content"},ve={class:"card-value"},he={class:"card-extra"},fe={class:"progress-text"},me={class:"card total-cases"},ye={class:"card-icon"},be={class:"card-content"},ge={class:"card-value"},we={class:"card pass-rate"},xe={class:"card-icon"},ke={class:"card-content"},Ce={class:"card-value"},Re={class:"card defects"},Se={class:"card-icon"},Ae={class:"card-content"},Fe={class:"card-value"},je={class:"charts-container"},ze={class:"chart-row"},Le={class:"chart-card"},Ve={class:"chart-card"},Te={class:"chart-row"},Ee={class:"chart-card"},Oe={class:"chart-card"},De={class:"chart-body table-body"},Be={class:"chart-row"},Pe={class:"chart-card"},qe={class:"ai-metrics-container"},Ie={class:"ai-metric-item"},Me={class:"metric-value"},Ne={class:"ai-metric-item"},Ue={class:"metric-value"},Ge={class:"ai-metric-item"},We={class:"metric-value"},Je={class:"chart-card"},Xe={__name:"AiTestReport",setup(He){const V=i([]),m=J({project:null,days:7}),y=i({}),T=i([]),g=i({});let d=null,u=null,_=null,p=null,v=null;const C=i(null),R=i(null),S=i(null),A=i(null),F=i(null),P=async()=>{try{const s=await f.get("/projects/");V.value=s.data.results||[]}catch(s){console.error("获取项目失败",s)}},q=async()=>{try{const s={project:m.project},e=await f.get("/reports/reports/dashboard/",{params:s});y.value=e.data}catch(s){console.error("获取概览数据失败",s)}},I=()=>{C.value&&(d=k(C.value)),R.value&&(u=k(R.value)),S.value&&(_=k(S.value)),A.value&&(p=k(A.value)),F.value&&(v=k(F.value)),window.addEventListener("resize",E)},E=()=>{d==null||d.resize(),u==null||u.resize(),_==null||_.resize(),p==null||p.resize(),v==null||v.resize()},M=async()=>{const s={project:m.project,days:m.days};try{const e=await f.get("/reports/reports/status_distribution/",{params:s}),o=[{value:e.data.passed,name:"通过",itemStyle:{color:"#67C23A"}},{value:e.data.failed,name:"失败",itemStyle:{color:"#F56C6C"}},{value:e.data.blocked,name:"阻塞",itemStyle:{color:"#E6A23C"}},{value:e.data.retest,name:"重测",itemStyle:{color:"#409EFF"}},{value:e.data.untested,name:"未测",itemStyle:{color:"#909399"}}];d.setOption({tooltip:{trigger:"item"},legend:{bottom:"0%",left:"center"},series:[{name:"执行状态",type:"pie",radius:["40%","70%"],center:["50%","45%"],avoidLabelOverlap:!1,itemStyle:{borderRadius:10,borderColor:"#fff",borderWidth:2},label:{show:!1,position:"center"},emphasis:{label:{show:!0,fontSize:20,fontWeight:"bold"}},labelLine:{show:!1},data:o}]})}catch(e){console.error(e)}try{const e=await f.get("/reports/reports/execution_trend/",{params:s}),o=e.data.map(l=>l.date),w=e.data.map(l=>l.count);u.setOption({tooltip:{trigger:"axis"},grid:{left:"3%",right:"4%",bottom:"3%",top:"10%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:o},yAxis:{type:"value"},series:[{name:"执行数量",type:"line",stack:"Total",smooth:!0,areaStyle:{opacity:.3,color:new le(0,0,0,1,[{offset:0,color:"#409EFF"},{offset:1,color:"#fff"}])},itemStyle:{color:"#409EFF"},data:w}]})}catch(e){console.error(e)}try{const e=await f.get("/reports/reports/defect_distribution/",{params:s});_.setOption({tooltip:{trigger:"item"},legend:{bottom:"0%",left:"center"},series:[{name:"优先级分布",type:"pie",radius:"60%",center:["50%","45%"],data:e.data,emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]})}catch(e){console.error(e)}try{const e=await f.get("/reports/reports/failed_cases_top/",{params:s});T.value=e.data}catch(e){console.error(e)}try{const e=await f.get("/reports/reports/ai_efficiency/",{params:s});g.value=e.data;const o=e.data.ai_vs_manual;p.setOption({tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},grid:{left:"3%",right:"4%",bottom:"3%",top:"10%",containLabel:!0},xAxis:{type:"value"},yAxis:{type:"category",data:["用例来源"]},series:[{name:"AI生成",type:"bar",stack:"total",label:{show:!0},itemStyle:{color:"#8e44ad"},data:[o.ai]},{name:"人工创建",type:"bar",stack:"total",label:{show:!0},itemStyle:{color:"#3498db"},data:[o.manual]}]})}catch(e){console.error(e)}try{const e=await f.get("/reports/reports/team_workload/",{params:s}),o=e.data.map(b=>b.username),w=e.data.map(b=>b.execution_count),l=e.data.map(b=>b.defect_count);v.setOption({tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},legend:{data:["执行用例","发现缺陷"],bottom:"0%"},grid:{left:"3%",right:"4%",bottom:"10%",top:"5%",containLabel:!0},xAxis:{type:"value"},yAxis:{type:"category",data:o},series:[{name:"执行用例",type:"bar",stack:"total",label:{show:!0},itemStyle:{color:"#409EFF"},data:w},{name:"发现缺陷",type:"bar",stack:"total",label:{show:!0},itemStyle:{color:"#F56C6C"},data:l}]})}catch(e){console.error(e)}},j=()=>{q(),M()},N=()=>{Q.success("报告导出功能开发中...")};return X(async()=>{await P(),await H(),I(),j()}),K(()=>{window.removeEventListener("resize",E),d==null||d.dispose(),u==null||u.dispose(),_==null||_.dispose(),p==null||p.dispose(),v==null||v.dispose()}),(s,e)=>{const o=h("el-option"),w=h("el-select"),l=h("el-icon"),b=h("el-button"),z=h("el-progress"),O=h("el-table-column"),U=h("el-tag"),G=h("el-table");return L(),D("div",re,[t("div",ce,[t("div",ie,[a(w,{modelValue:m.project,"onUpdate:modelValue":e[0]||(e[0]=c=>m.project=c),placeholder:"选择项目",clearable:"",onChange:j,style:{width:"200px"}},{default:r(()=>[(L(!0),D(Y,null,Z(V.value,c=>(L(),$(o,{key:c.id,label:c.name,value:c.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),a(w,{modelValue:m.days,"onUpdate:modelValue":e[1]||(e[1]=c=>m.days=c),placeholder:"时间范围",onChange:j,style:{width:"150px"}},{default:r(()=>[a(o,{label:"最近7天",value:7}),a(o,{label:"最近14天",value:14}),a(o,{label:"最近30天",value:30})]),_:1},8,["modelValue"])]),t("div",ne,[a(b,{type:"primary",onClick:N},{default:r(()=>[a(l,null,{default:r(()=>[a(x(ee))]),_:1}),e[2]||(e[2]=B(" 导出报告 ",-1))]),_:1,__:[2]})])]),t("div",de,[t("div",ue,[t("div",_e,[a(l,null,{default:r(()=>[a(x(te))]),_:1})]),t("div",pe,[t("div",ve,n(y.value.active_plans||0),1),e[3]||(e[3]=t("div",{class:"card-label"},"活跃计划",-1))]),t("div",he,[a(z,{type:"circle",percentage:y.value.plan_progress||0,width:40,"stroke-width":4,"show-text":!1},null,8,["percentage"]),t("span",fe,n(y.value.plan_progress||0)+"% 进度",1)])]),t("div",me,[t("div",ye,[a(l,null,{default:r(()=>[a(x(ae))]),_:1})]),t("div",be,[t("div",ge,n(y.value.total_cases||0),1),e[4]||(e[4]=t("div",{class:"card-label"},"用例总数",-1))])]),t("div",we,[t("div",xe,[a(l,null,{default:r(()=>[a(x(se))]),_:1})]),t("div",ke,[t("div",Ce,n(y.value.pass_rate||0)+"%",1),e[5]||(e[5]=t("div",{class:"card-label"},"通过率",-1))])]),t("div",Re,[t("div",Se,[a(l,null,{default:r(()=>[a(x(oe))]),_:1})]),t("div",Ae,[t("div",Fe,n(y.value.total_defects||0),1),e[6]||(e[6]=t("div",{class:"card-label"},"发现缺陷",-1))])])]),t("div",je,[t("div",ze,[t("div",Le,[e[7]||(e[7]=t("div",{class:"chart-header"},[t("h3",null,"执行状态分布")],-1)),t("div",{class:"chart-body",ref_key:"statusChartRef",ref:C},null,512)]),t("div",Ve,[e[8]||(e[8]=t("div",{class:"chart-header"},[t("h3",null,"每日执行趋势")],-1)),t("div",{class:"chart-body",ref_key:"trendChartRef",ref:R},null,512)])]),t("div",Te,[t("div",Ee,[e[9]||(e[9]=t("div",{class:"chart-header"},[t("h3",null,"失败用例优先级分布 (缺陷分布)")],-1)),t("div",{class:"chart-body",ref_key:"defectChartRef",ref:S},null,512)]),t("div",Oe,[e[10]||(e[10]=t("div",{class:"chart-header"},[t("h3",null,"失败用例 TOP 10")],-1)),t("div",De,[a(G,{data:T.value,style:{width:"100%"},size:"small"},{default:r(()=>[a(O,{prop:"testcase__title",label:"用例标题","show-overflow-tooltip":""}),a(O,{prop:"fail_count",label:"失败次数",width:"100",align:"center"},{default:r(c=>[a(U,{type:"danger"},{default:r(()=>[B(n(c.row.fail_count),1)]),_:2},1024)]),_:1})]),_:1},8,["data"])])])]),t("div",Be,[t("div",Pe,[e[14]||(e[14]=t("div",{class:"chart-header"},[t("h3",null,"AI生成效能分析")],-1)),t("div",qe,[t("div",Ie,[t("div",Me,n(g.value.adoption_rate||0)+"%",1),e[11]||(e[11]=t("div",{class:"metric-label"},"生成采纳率",-1)),a(z,{percentage:g.value.adoption_rate||0,"show-text":!1,status:"success"},null,8,["percentage"])]),t("div",Ne,[t("div",Ue,n(g.value.requirement_coverage||0)+"%",1),e[12]||(e[12]=t("div",{class:"metric-label"},"需求覆盖率",-1)),a(z,{percentage:g.value.requirement_coverage||0,"show-text":!1},null,8,["percentage"])]),t("div",Ge,[t("div",We,n(g.value.saved_hours||0)+"h",1),e[13]||(e[13]=t("div",{class:"metric-label"},"节省工时估算",-1))])]),t("div",{class:"chart-body-small",ref_key:"aiEfficiencyChartRef",ref:A},null,512)]),t("div",Je,[e[15]||(e[15]=t("div",{class:"chart-header"},[t("h3",null,"团队工作量统计")],-1)),t("div",{class:"chart-body",ref_key:"workloadChartRef",ref:F},null,512)])])])])}}},Ye=W(Xe,[["__scopeId","data-v-64ee970f"]]);export{Ye as default};
