import{_ as x,s as L,q as p,V as F,x as I,r as f,o as q,c as M,b as u,d as o,w as a,f as h,e as W}from"./index-644940f8.js";import{a9 as C,aa as y,ab as D}from"./ui_automation-3c95efdb.js";const S={name:"NotificationConfigs",components:{Setting:L},setup(){const V=p(null),e=p(null),B=p(null),l=p("feishu"),r=F({feishu:{name:"",webhook_url:"",enabled:!0,enable_ui_automation:!0,enable_api_testing:!0},wechat:{name:"",webhook_url:"",enabled:!0,enable_ui_automation:!0,enable_api_testing:!0},dingtalk:{name:"",webhook_url:"",secret:"",enabled:!0,enable_ui_automation:!0,enable_api_testing:!0}}),v=t=>({feishu:"webhook_feishu",wechat:"webhook_wechat",dingtalk:"webhook_dingtalk"})[t],U=async t=>{var m,_;if(t==="feishu"?V.value:t==="wechat"?e.value:B.value)try{const i=v(t);let w=null;try{const k=await C({config_type:i});k.data.results&&k.data.results.length>0&&(w=k.data.results[0].id)}catch{console.log("未找到现有Webhook配置，将创建新配置")}const d=r[t];let c;if(w){const n=(await C({config_type:i})).data.results[0],R=n.webhook_bots||{},N={name:d.name||`${t}机器人`,webhook_url:d.webhook_url,enabled:d.enabled};t==="dingtalk"&&d.secret&&(N.secret=d.secret),R[t]=N,c={name:n.name||`${t==="feishu"?"飞书":t==="wechat"?"企微":"钉钉"}机器人配置`,config_type:i,webhook_bots:R,is_active:!0,enable_ui_automation:d.enable_ui_automation,enable_api_testing:d.enable_api_testing},await y(w,c),W.success(`${t==="feishu"?"飞书":t==="wechat"?"企微":"钉钉"}机器人配置更新成功`)}else{const k={name:d.name||`${t}机器人`,webhook_url:d.webhook_url,enabled:d.enabled};t==="dingtalk"&&d.secret&&(k.secret=d.secret),c={name:`${t==="feishu"?"飞书":t==="wechat"?"企微":"钉钉"}机器人配置`,config_type:i,webhook_bots:{[t]:k},is_active:!0,enable_ui_automation:d.enable_ui_automation,enable_api_testing:d.enable_api_testing},await D(c),W.success(`${t==="feishu"?"飞书":t==="wechat"?"企微":"钉钉"}机器人配置创建成功`)}g(t)}catch(i){console.error("保存Webhook机器人配置失败:",i),W.error(`${t==="feishu"?"飞书":t==="wechat"?"企微":"钉钉"}机器人配置保存失败: `+(((_=(m=i.response)==null?void 0:m.data)==null?void 0:_.detail)||i.message))}},g=async t=>{try{const s=v(t),m=await C({config_type:s});if(m.data.results&&m.data.results.length>0){const _=m.data.results[0];if(r[t].enable_ui_automation=_.enable_ui_automation!==!1,r[t].enable_api_testing=_.enable_api_testing!==!1,_.webhook_bots&&_.webhook_bots[t]){const i=_.webhook_bots[t];r[t].name=i.name||"",r[t].webhook_url=i.webhook_url||"",r[t].enabled=i.enabled!==!1,t==="dingtalk"&&i.secret&&(r[t].secret=i.secret)}}}catch(s){console.error("获取Webhook机器人配置失败:",s)}},b=async()=>{try{for(const t of Object.keys(r))await g(t)}catch(t){console.error("获取所有Webhook机器人配置失败:",t)}};return I(async()=>{try{console.log("NotificationConfigs 组件开始初始化"),await b(),console.log("NotificationConfigs 组件初始化完成")}catch(t){console.error("NotificationConfigs 组件初始化失败:",t)}}),{feishuFormRef:V,wechatFormRef:e,dingtalkFormRef:B,activeTab:l,webhookBots:r,saveWebhookBot:U,fetchWebhookConfig:g,fetchAllWebhookConfigs:b}}},E={class:"notification-configs-container"},j={class:"page-header"},A={class:"page-title"},O={class:"content-wrapper"},z={class:"tab-content"},G={class:"config-section"},H={class:"form-actions"},J={class:"tab-content"},K={class:"config-section"},P={class:"form-actions"},Q={class:"tab-content"},X={class:"config-section"},Y={class:"form-actions"};function Z(V,e,B,l,r,v){const U=f("Setting"),g=f("el-icon"),b=f("el-input"),t=f("el-form-item"),s=f("el-col"),m=f("el-switch"),_=f("el-checkbox"),i=f("el-row"),w=f("el-button"),d=f("el-form"),c=f("el-tab-pane"),k=f("el-tabs");return q(),M("div",E,[u("div",j,[u("h1",A,[o(g,{class:"title-icon"},{default:a(()=>[o(U)]),_:1}),e[20]||(e[20]=h(" UI自动化通知配置 ",-1))]),e[21]||(e[21]=u("p",{class:"page-description"}," 配置飞书、企微、钉钉Webhook机器人地址 ",-1))]),u("div",O,[o(k,{modelValue:l.activeTab,"onUpdate:modelValue":e[19]||(e[19]=n=>l.activeTab=n),class:"notification-tabs"},{default:a(()=>[o(c,{label:"飞书机器人",name:"feishu"},{default:a(()=>[u("div",z,[u("div",G,[o(d,{ref:"feishuFormRef",model:l.webhookBots.feishu,"label-position":"top",class:"config-form"},{default:a(()=>[o(i,{gutter:20},{default:a(()=>[o(s,{span:12},{default:a(()=>[o(t,{label:"机器人名称"},{default:a(()=>[o(b,{modelValue:l.webhookBots.feishu.name,"onUpdate:modelValue":e[0]||(e[0]=n=>l.webhookBots.feishu.name=n),placeholder:"请输入飞书机器人名称"},null,8,["modelValue"])]),_:1})]),_:1}),o(s,{span:12},{default:a(()=>[o(t,{label:"启用"},{default:a(()=>[o(m,{modelValue:l.webhookBots.feishu.enabled,"onUpdate:modelValue":e[1]||(e[1]=n=>l.webhookBots.feishu.enabled=n)},null,8,["modelValue"])]),_:1})]),_:1}),o(s,{span:24},{default:a(()=>[o(t,{label:"Webhook URL"},{default:a(()=>[o(b,{modelValue:l.webhookBots.feishu.webhook_url,"onUpdate:modelValue":e[2]||(e[2]=n=>l.webhookBots.feishu.webhook_url=n),placeholder:"请输入飞书机器人Webhook URL"},null,8,["modelValue"]),e[22]||(e[22]=u("div",{class:"form-item-hint"}," 飞书机器人Webhook URL格式：https://open.feishu.cn/open-apis/bot/v2/hook/... ",-1))]),_:1,__:[22]})]),_:1}),o(s,{span:24},{default:a(()=>[o(t,{label:"业务类型"},{default:a(()=>[o(_,{modelValue:l.webhookBots.feishu.enable_ui_automation,"onUpdate:modelValue":e[3]||(e[3]=n=>l.webhookBots.feishu.enable_ui_automation=n)},{default:a(()=>e[23]||(e[23]=[h("UI自动化测试",-1)])),_:1,__:[23]},8,["modelValue"]),o(_,{modelValue:l.webhookBots.feishu.enable_api_testing,"onUpdate:modelValue":e[4]||(e[4]=n=>l.webhookBots.feishu.enable_api_testing=n)},{default:a(()=>e[24]||(e[24]=[h("接口测试",-1)])),_:1,__:[24]},8,["modelValue"])]),_:1})]),_:1})]),_:1}),u("div",H,[o(w,{type:"primary",onClick:e[5]||(e[5]=n=>l.saveWebhookBot("feishu"))},{default:a(()=>e[25]||(e[25]=[h(" 保存飞书机器人配置 ",-1)])),_:1,__:[25]})])]),_:1},8,["model"])])])]),_:1}),o(c,{label:"企微机器人",name:"wechat"},{default:a(()=>[u("div",J,[u("div",K,[o(d,{ref:"wechatFormRef",model:l.webhookBots.wechat,"label-position":"top",class:"config-form"},{default:a(()=>[o(i,{gutter:20},{default:a(()=>[o(s,{span:12},{default:a(()=>[o(t,{label:"机器人名称"},{default:a(()=>[o(b,{modelValue:l.webhookBots.wechat.name,"onUpdate:modelValue":e[6]||(e[6]=n=>l.webhookBots.wechat.name=n),placeholder:"请输入企业微信机器人名称"},null,8,["modelValue"])]),_:1})]),_:1}),o(s,{span:12},{default:a(()=>[o(t,{label:"启用"},{default:a(()=>[o(m,{modelValue:l.webhookBots.wechat.enabled,"onUpdate:modelValue":e[7]||(e[7]=n=>l.webhookBots.wechat.enabled=n)},null,8,["modelValue"])]),_:1})]),_:1}),o(s,{span:24},{default:a(()=>[o(t,{label:"Webhook URL"},{default:a(()=>[o(b,{modelValue:l.webhookBots.wechat.webhook_url,"onUpdate:modelValue":e[8]||(e[8]=n=>l.webhookBots.wechat.webhook_url=n),placeholder:"请输入企业微信机器人Webhook URL"},null,8,["modelValue"]),e[26]||(e[26]=u("div",{class:"form-item-hint"}," 企业微信机器人Webhook URL格式：https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=... ",-1))]),_:1,__:[26]})]),_:1}),o(s,{span:24},{default:a(()=>[o(t,{label:"业务类型"},{default:a(()=>[o(_,{modelValue:l.webhookBots.wechat.enable_ui_automation,"onUpdate:modelValue":e[9]||(e[9]=n=>l.webhookBots.wechat.enable_ui_automation=n)},{default:a(()=>e[27]||(e[27]=[h("UI自动化测试",-1)])),_:1,__:[27]},8,["modelValue"]),o(_,{modelValue:l.webhookBots.wechat.enable_api_testing,"onUpdate:modelValue":e[10]||(e[10]=n=>l.webhookBots.wechat.enable_api_testing=n)},{default:a(()=>e[28]||(e[28]=[h("接口测试",-1)])),_:1,__:[28]},8,["modelValue"])]),_:1})]),_:1})]),_:1}),u("div",P,[o(w,{type:"primary",onClick:e[11]||(e[11]=n=>l.saveWebhookBot("wechat"))},{default:a(()=>e[29]||(e[29]=[h(" 保存企微机器人配置 ",-1)])),_:1,__:[29]})])]),_:1},8,["model"])])])]),_:1}),o(c,{label:"钉钉机器人",name:"dingtalk"},{default:a(()=>[u("div",Q,[u("div",X,[o(d,{ref:"dingtalkFormRef",model:l.webhookBots.dingtalk,"label-position":"top",class:"config-form"},{default:a(()=>[o(i,{gutter:20},{default:a(()=>[o(s,{span:12},{default:a(()=>[o(t,{label:"机器人名称"},{default:a(()=>[o(b,{modelValue:l.webhookBots.dingtalk.name,"onUpdate:modelValue":e[12]||(e[12]=n=>l.webhookBots.dingtalk.name=n),placeholder:"请输入钉钉机器人名称"},null,8,["modelValue"])]),_:1})]),_:1}),o(s,{span:12},{default:a(()=>[o(t,{label:"启用"},{default:a(()=>[o(m,{modelValue:l.webhookBots.dingtalk.enabled,"onUpdate:modelValue":e[13]||(e[13]=n=>l.webhookBots.dingtalk.enabled=n)},null,8,["modelValue"])]),_:1})]),_:1}),o(s,{span:24},{default:a(()=>[o(t,{label:"Webhook URL"},{default:a(()=>[o(b,{modelValue:l.webhookBots.dingtalk.webhook_url,"onUpdate:modelValue":e[14]||(e[14]=n=>l.webhookBots.dingtalk.webhook_url=n),placeholder:"请输入钉钉机器人Webhook URL"},null,8,["modelValue"]),e[30]||(e[30]=u("div",{class:"form-item-hint"}," 钉钉机器人Webhook URL格式：https://oapi.dingtalk.com/robot/send?access_token=... ",-1))]),_:1,__:[30]})]),_:1}),o(s,{span:24},{default:a(()=>[o(t,{label:"签名密钥"},{default:a(()=>[o(b,{modelValue:l.webhookBots.dingtalk.secret,"onUpdate:modelValue":e[15]||(e[15]=n=>l.webhookBots.dingtalk.secret=n),placeholder:"请输入钉钉机器人签名密钥（可选）",type:"password","show-password":""},null,8,["modelValue"]),e[31]||(e[31]=u("div",{class:"form-item-hint"},' 钉钉机器人的签名密钥，用于安全验证。如果机器人开启了"加签"安全设置，请填写此字段。 ',-1))]),_:1,__:[31]})]),_:1}),o(s,{span:24},{default:a(()=>[o(t,{label:"业务类型"},{default:a(()=>[o(_,{modelValue:l.webhookBots.dingtalk.enable_ui_automation,"onUpdate:modelValue":e[16]||(e[16]=n=>l.webhookBots.dingtalk.enable_ui_automation=n)},{default:a(()=>e[32]||(e[32]=[h("UI自动化测试",-1)])),_:1,__:[32]},8,["modelValue"]),o(_,{modelValue:l.webhookBots.dingtalk.enable_api_testing,"onUpdate:modelValue":e[17]||(e[17]=n=>l.webhookBots.dingtalk.enable_api_testing=n)},{default:a(()=>e[33]||(e[33]=[h("接口测试",-1)])),_:1,__:[33]},8,["modelValue"])]),_:1})]),_:1})]),_:1}),u("div",Y,[o(w,{type:"primary",onClick:e[18]||(e[18]=n=>l.saveWebhookBot("dingtalk"))},{default:a(()=>e[34]||(e[34]=[h(" 保存钉钉机器人配置 ",-1)])),_:1,__:[34]})])]),_:1},8,["model"])])])]),_:1})]),_:1},8,["modelValue"])])])}const ee=x(S,[["render",Z],["__scopeId","data-v-8ad7ab24"]]);export{ee as default};
