import{_,C as p,e as u,o as d,c,b as s,F as y,y as C,B as f,t as r,A as v,f as g,N as b,O as h,P as M,aa as k,G as m}from"./index-054e2682.js";const D={name:"PromptConfig",data(){return{configs:[],showAddModal:!1,showEditModal:!1,showPreviewModal:!1,showDefaultsModal:!1,isEditing:!1,isSaving:!1,isLoadingDefaults:!1,editingConfigId:null,previewConfig:{},defaultPrompts:{writer:"",reviewer:""},activeTab:"writer",configForm:{name:"",prompt_type:"",content:"",is_active:!0}}},mounted(){this.loadConfigs()},methods:{openAddModal(){console.log("openAddModal clicked"),this.resetForm(),this.isEditing=!1,this.showAddModal=!0,console.log("showAddModal set to:",this.showAddModal)},async loadConfigs(){var l,e,n;try{console.log("Loading prompt configs...");const a=await p.get("/requirement-analysis/api/prompts/");console.log("Prompts API response:",a.data),a.data&&a.data.results&&Array.isArray(a.data.results)?(this.configs=a.data.results,console.log("Loaded configs from results:",this.configs)):a.data&&Array.isArray(a.data)?(this.configs=a.data,console.log("Loaded configs from direct array:",this.configs)):(console.warn("Unexpected API response format:",a.data),this.configs=[]),console.log("Final configs count:",this.configs.length)}catch(a){console.error("åŠ è½½é…ç½®å¤±è´¥:",a),this.configs=[],((l=a.response)==null?void 0:l.status)===401?u.error("è¯·å…ˆç™»å½•"):u.error("åŠ è½½é…ç½®å¤±è´¥: "+(((n=(e=a.response)==null?void 0:e.data)==null?void 0:n.error)||a.message))}},async loadDefaultPrompts(){var l,e;console.log("loadDefaultPrompts clicked");try{const n=await p.get("/requirement-analysis/api/prompts/load_defaults/");console.log("Default prompts response:",n.data),this.defaultPrompts=n.data.defaults,this.showDefaultsModal=!0,console.log("showDefaultsModal set to:",this.showDefaultsModal)}catch(n){console.error("åŠ è½½é»˜è®¤æç¤ºè¯å¤±è´¥:",n),u.error("åŠ è½½é»˜è®¤æç¤ºè¯å¤±è´¥: "+(((e=(l=n.response)==null?void 0:l.data)==null?void 0:e.error)||n.message))}},async confirmLoadDefaults(){var l,e;this.isLoadingDefaults=!0;try{this.defaultPrompts.writer&&await p.post("/requirement-analysis/api/prompts/",{name:"é»˜è®¤ç”¨ä¾‹ç¼–å†™æç¤ºè¯",prompt_type:"writer",content:this.defaultPrompts.writer,is_active:!0}),this.defaultPrompts.reviewer&&await p.post("/requirement-analysis/api/prompts/",{name:"é»˜è®¤ç”¨ä¾‹è¯„å®¡æç¤ºè¯",prompt_type:"reviewer",content:this.defaultPrompts.reviewer,is_active:!0}),u.success("é»˜è®¤æç¤ºè¯åŠ è½½æˆåŠŸ"),this.closeDefaultsModal(),this.loadConfigs()}catch(n){console.error("åŠ è½½é»˜è®¤æç¤ºè¯å¤±è´¥:",n),u.error("åŠ è½½å¤±è´¥: "+(((e=(l=n.response)==null?void 0:l.data)==null?void 0:e.error)||n.message))}finally{this.isLoadingDefaults=!1}},resetForm(){this.configForm={name:"",prompt_type:"",content:"",is_active:!0}},editConfig(l){this.isEditing=!0,this.editingConfigId=l.id,this.configForm={name:l.name,prompt_type:l.prompt_type,content:l.content,is_active:l.is_active},this.showEditModal=!0},previewPrompt(l){this.previewConfig=l,this.showPreviewModal=!0},async saveConfig(){var l,e;this.isSaving=!0;try{this.isEditing?(await p.patch(`/requirement-analysis/api/prompts/${this.editingConfigId}/`,this.configForm),u.success("é…ç½®æ›´æ–°æˆåŠŸ")):(await p.post("/requirement-analysis/api/prompts/",this.configForm),u.success("é…ç½®æ·»åŠ æˆåŠŸ")),this.closeModals(),this.loadConfigs()}catch(n){console.error("ä¿å­˜é…ç½®å¤±è´¥:",n),u.error("ä¿å­˜å¤±è´¥: "+(((e=(l=n.response)==null?void 0:l.data)==null?void 0:e.error)||n.message))}finally{this.isSaving=!1}},async deleteConfig(l){var e,n;if(confirm("ç¡®å®šè¦åˆ é™¤æ­¤é…ç½®å—ï¼Ÿ"))try{await p.delete(`/requirement-analysis/api/prompts/${l}/`),u.success("é…ç½®åˆ é™¤æˆåŠŸ"),this.loadConfigs()}catch(a){console.error("åˆ é™¤é…ç½®å¤±è´¥:",a),u.error("åˆ é™¤å¤±è´¥: "+(((n=(e=a.response)==null?void 0:e.data)==null?void 0:n.error)||a.message))}},closeModals(){this.showAddModal=!1,this.showEditModal=!1,this.isEditing=!1,this.editingConfigId=null,this.resetForm()},closePreview(){this.showPreviewModal=!1,this.previewConfig={}},closeDefaultsModal(){this.showDefaultsModal=!1,this.defaultPrompts={writer:"",reviewer:""},this.activeTab="writer"},truncateContent(l,e){return l?l.length<=e?l:l.substring(0,e)+"...":""},formatDateTime(l){return l?new Date(l).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):""}}},P={class:"prompt-config"},A={class:"main-content"},F={class:"configs-section"},x={class:"section-header"},q={class:"header-actions"},E={class:"configs-grid"},L={class:"config-header"},T={class:"config-title"},I={class:"config-badges"},S={class:"config-actions"},V=["onClick"],N=["onClick"],U=["onClick"],B={class:"config-details"},z={class:"prompt-preview"},G={class:"content-preview"},O={class:"config-meta"},j={class:"meta-item"},H={class:"meta-item"},J={class:"meta-item"},K={key:0,class:"empty-state"},Q={class:"empty-actions"},R={class:"modal-header"},W={class:"modal-body"},X={class:"form-group"},Y={class:"form-group"},Z={class:"form-group"},$={class:"textarea-container"},ss={class:"char-count"},es={class:"form-group"},ts={class:"checkbox-label"},os={class:"modal-actions"},is=["disabled"],ls={key:0},ns={key:1},as={class:"modal-header"},rs={class:"modal-body"},ds={class:"preview-content"},cs={class:"preview-meta"},us={class:"meta-item"},ps={class:"meta-item"},ms={class:"content-display"},fs={class:"content-text"},vs={class:"modal-header"},gs={class:"modal-body"},bs={class:"defaults-content"},ws={class:"tabs"},hs={class:"tab-content"},_s={class:"content-display"},ys={class:"content-text"},Cs={class:"modal-actions"},Ms=["disabled"],ks={key:0},Ds={key:1};function Ps(l,e,n,a,i,o){return d(),c("div",P,[e[43]||(e[43]=s("div",{class:"page-header"},[s("h1",null,"ğŸ“ æç¤ºè¯é…ç½®"),s("p",null,"é…ç½®ç”¨äºæµ‹è¯•ç”¨ä¾‹ç¼–å†™å’Œè¯„å®¡çš„AIæç¤ºè¯")],-1)),s("div",A,[s("div",F,[s("div",x,[e[23]||(e[23]=s("h2",null,"æç¤ºè¯é…ç½®åˆ—è¡¨",-1)),s("div",q,[s("button",{class:"load-defaults-btn",onClick:e[0]||(e[0]=(...t)=>o.loadDefaultPrompts&&o.loadDefaultPrompts(...t))}," ğŸ“‚ åŠ è½½é»˜è®¤æç¤ºè¯ "),s("button",{class:"add-config-btn",onClick:e[1]||(e[1]=(...t)=>o.openAddModal&&o.openAddModal(...t))}," â• æ·»åŠ é…ç½® ")])]),s("div",E,[(d(!0),c(y,null,C(i.configs,t=>(d(),c("div",{key:t.id,class:"config-card"},[s("div",L,[s("div",T,[s("h3",null,r(t.name),1),s("div",I,[s("span",{class:m(["type-badge",t.prompt_type])},r(t.prompt_type_display),3),s("span",{class:m(["status-badge",{active:t.is_active}])},r(t.is_active?"å¯ç”¨":"ç¦ç”¨"),3)])]),s("div",S,[s("button",{class:"preview-btn",onClick:w=>o.previewPrompt(t)},"ğŸ‘ï¸ é¢„è§ˆ",8,V),s("button",{class:"edit-btn",onClick:w=>o.editConfig(t)},"âœï¸ ç¼–è¾‘",8,N),s("button",{class:"delete-btn",onClick:w=>o.deleteConfig(t.id)},"ğŸ—‘ï¸ åˆ é™¤",8,U)])]),s("div",B,[s("div",z,[e[24]||(e[24]=s("label",null,"æç¤ºè¯å†…å®¹é¢„è§ˆ:",-1)),s("div",G,r(o.truncateContent(t.content,200)),1)]),s("div",O,[s("div",j,[e[25]||(e[25]=s("label",null,"åˆ›å»ºæ—¶é—´:",-1)),s("span",null,r(o.formatDateTime(t.created_at)),1)]),s("div",H,[e[26]||(e[26]=s("label",null,"æ›´æ–°æ—¶é—´:",-1)),s("span",null,r(o.formatDateTime(t.updated_at)),1)]),s("div",J,[e[27]||(e[27]=s("label",null,"åˆ›å»ºè€…:",-1)),s("span",null,r(t.created_by_name||"æœªçŸ¥"),1)])])])]))),128))]),i.configs.length===0?(d(),c("div",K,[e[28]||(e[28]=s("div",{class:"empty-icon"},"ğŸ“",-1)),e[29]||(e[29]=s("h3",null,"æš‚æ— æç¤ºè¯é…ç½®",-1)),e[30]||(e[30]=s("p",null,"è¯·æ·»åŠ æç¤ºè¯é…ç½®ä»¥è‡ªå®šä¹‰AIçš„è¡Œä¸ºå’Œè¾“å‡ºæ ¼å¼",-1)),s("div",Q,[s("button",{class:"add-first-config-btn",onClick:e[2]||(e[2]=(...t)=>o.openAddModal&&o.openAddModal(...t))}," â• æ·»åŠ ç¬¬ä¸€ä¸ªé…ç½® "),s("button",{class:"load-defaults-first-btn",onClick:e[3]||(e[3]=(...t)=>o.loadDefaultPrompts&&o.loadDefaultPrompts(...t))}," ğŸ“‚ åŠ è½½é»˜è®¤æç¤ºè¯ ")])])):f("",!0)])]),i.showAddModal||i.showEditModal?(d(),c("div",{key:0,class:"config-modal",onClick:e[12]||(e[12]=(...t)=>o.closeModals&&o.closeModals(...t))},[s("div",{class:"modal-content large",onClick:e[11]||(e[11]=v(()=>{},["stop"]))},[s("div",R,[s("h3",null,r(i.isEditing?"ç¼–è¾‘":"æ·»åŠ ")+"æç¤ºè¯é…ç½®",1),s("button",{class:"close-btn",onClick:e[4]||(e[4]=(...t)=>o.closeModals&&o.closeModals(...t))},"Ã—")]),s("div",W,[s("form",{onSubmit:e[10]||(e[10]=v((...t)=>o.saveConfig&&o.saveConfig(...t),["prevent"]))},[s("div",X,[e[31]||(e[31]=s("label",null,[g("é…ç½®åç§° "),s("span",{class:"required"},"*")],-1)),b(s("input",{"onUpdate:modelValue":e[5]||(e[5]=t=>i.configForm.name=t),type:"text",class:"form-input",placeholder:"ä¾‹å¦‚ï¼šæµ‹è¯•ç”¨ä¾‹ç¼–å†™æç¤ºè¯ v1.0",required:""},null,512),[[h,i.configForm.name]])]),s("div",Y,[e[33]||(e[33]=s("label",null,[g("æç¤ºè¯ç±»å‹ "),s("span",{class:"required"},"*")],-1)),b(s("select",{"onUpdate:modelValue":e[6]||(e[6]=t=>i.configForm.prompt_type=t),class:"form-select",required:""},e[32]||(e[32]=[s("option",{value:""},"è¯·é€‰æ‹©æç¤ºè¯ç±»å‹",-1),s("option",{value:"writer"},"ç”¨ä¾‹ç¼–å†™æç¤ºè¯",-1),s("option",{value:"reviewer"},"ç”¨ä¾‹è¯„å®¡æç¤ºè¯",-1)]),512),[[M,i.configForm.prompt_type]])]),s("div",Z,[e[34]||(e[34]=s("label",null,[g("æç¤ºè¯å†…å®¹ "),s("span",{class:"required"},"*")],-1)),s("div",$,[b(s("textarea",{"onUpdate:modelValue":e[7]||(e[7]=t=>i.configForm.content=t),class:"form-textarea large",rows:"20",placeholder:"è¾“å…¥æç¤ºè¯å†…å®¹ï¼Œæ”¯æŒMarkdownæ ¼å¼",required:""},null,512),[[h,i.configForm.content]]),s("div",ss,r(i.configForm.content.length)+" å­—ç¬¦",1)]),e[35]||(e[35]=s("div",{class:"textarea-tips"},[s("p",null,[s("strong",null,"æç¤ºè¯ç¼–å†™å»ºè®®ï¼š")]),s("ul",null,[s("li",null,"æ˜ç¡®å®šä¹‰AIçš„è§’è‰²å’Œä¸“ä¸šé¢†åŸŸ"),s("li",null,"è¯¦ç»†è¯´æ˜è¾“å‡ºæ ¼å¼è¦æ±‚"),s("li",null,"æä¾›å…·ä½“çš„ç¤ºä¾‹å’Œæ¨¡æ¿"),s("li",null,"è¯´æ˜éœ€è¦è€ƒè™‘çš„æµ‹è¯•åœºæ™¯å’Œè¾¹ç•Œæ¡ä»¶")])],-1))]),s("div",es,[s("label",ts,[b(s("input",{"onUpdate:modelValue":e[8]||(e[8]=t=>i.configForm.is_active=t),type:"checkbox"},null,512),[[k,i.configForm.is_active]]),e[36]||(e[36]=s("span",{class:"checkmark"},null,-1)),e[37]||(e[37]=g(" å¯ç”¨æ­¤é…ç½® ",-1))]),e[38]||(e[38]=s("div",{class:"checkbox-hint"}," æ³¨æ„ï¼šæ¯ç§ç±»å‹åªèƒ½æœ‰ä¸€ä¸ªå¯ç”¨çš„é…ç½® ",-1))]),s("div",os,[s("button",{type:"button",class:"cancel-btn",onClick:e[9]||(e[9]=(...t)=>o.closeModals&&o.closeModals(...t))},"å–æ¶ˆ"),s("button",{type:"submit",class:"confirm-btn",disabled:i.isSaving},[i.isSaving?(d(),c("span",ls,"ğŸ”„ ä¿å­˜ä¸­...")):(d(),c("span",ns,"ğŸ’¾ ä¿å­˜é…ç½®"))],8,is)])],32)])])])):f("",!0),i.showPreviewModal?(d(),c("div",{key:1,class:"preview-modal",onClick:e[15]||(e[15]=(...t)=>o.closePreview&&o.closePreview(...t))},[s("div",{class:"modal-content large",onClick:e[14]||(e[14]=v(()=>{},["stop"]))},[s("div",as,[s("h3",null,"æç¤ºè¯é¢„è§ˆ - "+r(i.previewConfig.name),1),s("button",{class:"close-btn",onClick:e[13]||(e[13]=(...t)=>o.closePreview&&o.closePreview(...t))},"Ã—")]),s("div",rs,[s("div",ds,[s("div",cs,[s("div",us,[e[39]||(e[39]=s("label",null,"ç±»å‹:",-1)),s("span",{class:m(["type-badge",i.previewConfig.prompt_type])},r(i.previewConfig.prompt_type_display),3)]),s("div",ps,[e[40]||(e[40]=s("label",null,"çŠ¶æ€:",-1)),s("span",{class:m(["status-badge",{active:i.previewConfig.is_active}])},r(i.previewConfig.is_active?"å¯ç”¨":"ç¦ç”¨"),3)])]),s("div",ms,[e[41]||(e[41]=s("label",null,"æç¤ºè¯å†…å®¹:",-1)),s("div",fs,r(i.previewConfig.content),1)])])])])])):f("",!0),i.showDefaultsModal?(d(),c("div",{key:2,class:"defaults-modal",onClick:e[22]||(e[22]=(...t)=>o.closeDefaultsModal&&o.closeDefaultsModal(...t))},[s("div",{class:"modal-content large",onClick:e[21]||(e[21]=v(()=>{},["stop"]))},[s("div",vs,[e[42]||(e[42]=s("h3",null,"é»˜è®¤æç¤ºè¯é¢„è§ˆ",-1)),s("button",{class:"close-btn",onClick:e[16]||(e[16]=(...t)=>o.closeDefaultsModal&&o.closeDefaultsModal(...t))},"Ã—")]),s("div",gs,[s("div",bs,[s("div",ws,[s("button",{class:m(["tab-btn",{active:i.activeTab==="writer"}]),onClick:e[17]||(e[17]=t=>i.activeTab="writer")}," ğŸ“ ç¼–å†™æç¤ºè¯ ",2),s("button",{class:m(["tab-btn",{active:i.activeTab==="reviewer"}]),onClick:e[18]||(e[18]=t=>i.activeTab="reviewer")}," ğŸ” è¯„å®¡æç¤ºè¯ ",2)]),s("div",hs,[s("div",_s,[s("div",ys,r(i.defaultPrompts[i.activeTab]||"æš‚æ— å†…å®¹"),1)])])]),s("div",Cs,[s("button",{class:"cancel-btn",onClick:e[19]||(e[19]=(...t)=>o.closeDefaultsModal&&o.closeDefaultsModal(...t))},"å–æ¶ˆ"),s("button",{class:"confirm-btn",onClick:e[20]||(e[20]=(...t)=>o.confirmLoadDefaults&&o.confirmLoadDefaults(...t)),disabled:i.isLoadingDefaults},[i.isLoadingDefaults?(d(),c("span",ks,"ğŸ”„ åŠ è½½ä¸­...")):(d(),c("span",Ds,"ğŸ“‚ ç¡®è®¤åŠ è½½"))],8,Ms)])])])])):f("",!0)])}const Fs=_(D,[["render",Ps],["__scopeId","data-v-b2d593f9"]]);export{Fs as default};
