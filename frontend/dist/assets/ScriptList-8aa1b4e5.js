import{_ as re,u as ie,q as d,V as ue,x as de,r,o as V,c as M,b as i,d as t,w as a,e as _,F as pe,y as ce,J as _e,g as z,D as me,f as n,t as s,av as ve,ae as fe,cJ as ge,H as ye,B as I,N as we,O as be,E as ke}from"./index-054e2682.js";import{b as Ce,A as xe,B as F,C as Se}from"./ui_automation-53e326f9.js";const Ve={class:"script-list"},ze={class:"page-header"},he={class:"header-actions"},Te={class:"main-content"},Ne={class:"pagination"},De={key:0,class:"script-detail"},Me={class:"script-content"},Ue={class:"code-view"},Be={key:0,class:"script-editor"},Ee={class:"editor-header"},$e={class:"script-name"},je={class:"editor-info"},Pe={class:"editor-container"},Le={__name:"ScriptList",setup(Ie){const R=ie(),h=d([]),w=d(""),T=d([]),b=d(1),U=d(20),N=d(0),k=d(!1),C=d(!1),x=d(!1),p=d(null),u=d(null),B=d(!1),m=ue({scriptId:null,newName:""}),J=async()=>{try{const o=await Ce({page_size:100});h.value=o.data.results||o.data}catch(o){_.error("获取项目列表失败"),console.error("获取项目列表失败:",o)}},v=async()=>{if(!w.value){T.value=[],N.value=0;return}try{const o=await xe({project:w.value,page:b.value,page_size:U.value});o.data.results?(T.value=o.data.results,N.value=o.data.count||0):(T.value=o.data,N.value=o.data.length)}catch(o){_.error("获取脚本列表失败"),console.error("获取脚本列表失败:",o)}},O=async()=>{b.value=1,await v()},A=async()=>{b.value=1,await v()},q=async()=>{await v()},H=()=>{R.push("/ui-automation/scripts/editor")},K=o=>{p.value=o,k.value=!0},L=o=>{u.value={...o},k.value=!1,x.value=!0},W=async()=>{if(u.value)try{B.value=!0,await F(u.value.id,{content:u.value.content}),_.success("脚本保存成功"),x.value=!1,await v()}catch(o){_.error("脚本保存���败"),console.error("脚本保存失败:",o)}finally{B.value=!1}},Y=o=>{m.scriptId=o.id,m.newName=o.name,C.value=!0},G=async()=>{if(!m.newName.trim()){_.warning("请输入新的脚本名称");return}try{await F(m.scriptId,{name:m.newName}),_.success("重命名成功"),C.value=!1,await v()}catch(o){_.error("重命名失败"),console.error("重命名失败:",o)}},Q=async o=>{try{await ke.confirm(`确定要删除脚本"${o.name}"吗？此操作不可恢复。`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await Se(o.id),_.success("删除成功"),await v()}catch(e){e!=="cancel"&&(_.error("删除失败"),console.error("删除失败:",e))}},X=o=>({CODE:"代码脚本",VISUAL:"可视化脚本",KEYWORD:"关键字脚本"})[o]||o,E=o=>({python:"Python",javascript:"JavaScript"})[o]||o||"未知",$=o=>({playwright:"Playwright",selenium:"Selenium"})[o]||o||"未知",j=o=>o?new Date(o).toLocaleString():"";return de(async()=>{await J(),h.value.length>0&&(w.value=h.value[0].id,await v())}),(o,e)=>{const Z=r("el-option"),ee=r("el-select"),S=r("el-icon"),c=r("el-button"),f=r("el-table-column"),D=r("el-tag"),te=r("el-table"),ae=r("el-pagination"),g=r("el-descriptions-item"),le=r("el-descriptions"),P=r("el-dialog"),oe=r("el-input"),ne=r("el-form-item"),se=r("el-form");return V(),M("div",Ve,[i("div",ze,[e[13]||(e[13]=i("h1",{class:"page-title"},"脚本列表",-1)),i("div",he,[t(ee,{modelValue:w.value,"onUpdate:modelValue":e[0]||(e[0]=l=>w.value=l),placeholder:"选择项目",style:{width:"200px","margin-right":"15px"},onChange:O},{default:a(()=>[(V(!0),M(pe,null,ce(h.value,l=>(V(),_e(Z,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),t(c,{type:"primary",onClick:H},{default:a(()=>[t(S,null,{default:a(()=>[t(z(me))]),_:1}),e[12]||(e[12]=n(" 新建脚本 ",-1))]),_:1,__:[12]})])]),i("div",Te,[t(te,{data:T.value,stripe:"",style:{width:"100%"}},{default:a(()=>[t(f,{type:"index",label:"序号",width:"60"}),t(f,{label:"项目",width:"150"},{default:a(({row:l})=>{var y;return[n(s(((y=l.project)==null?void 0:y.name)||"未知项目"),1)]}),_:1}),t(f,{prop:"name",label:"名称","min-width":"300","show-overflow-tooltip":""}),t(f,{label:"语言",width:"100"},{default:a(({row:l})=>[t(D,{size:"small",type:l.language==="python"?"success":"primary"},{default:a(()=>[n(s(E(l.language)),1)]),_:2},1032,["type"])]),_:1}),t(f,{label:"框架",width:"120"},{default:a(({row:l})=>[t(D,{size:"small",type:l.framework==="playwright"?"warning":"info"},{default:a(()=>[n(s($(l.framework)),1)]),_:2},1032,["type"])]),_:1}),t(f,{prop:"created_at",label:"创建时间",width:"180"},{default:a(({row:l})=>[n(s(j(l.created_at)),1)]),_:1}),t(f,{label:"操作",width:"280",fixed:"right"},{default:a(({row:l})=>[t(c,{size:"small",text:"",onClick:y=>K(l)},{default:a(()=>[t(S,null,{default:a(()=>[t(z(ve))]),_:1}),e[14]||(e[14]=n(" 查看详情 ",-1))]),_:2,__:[14]},1032,["onClick"]),t(c,{size:"small",text:"",onClick:y=>L(l)},{default:a(()=>[t(S,null,{default:a(()=>[t(z(fe))]),_:1}),e[15]||(e[15]=n(" 编辑 ",-1))]),_:2,__:[15]},1032,["onClick"]),t(c,{size:"small",text:"",onClick:y=>Y(l)},{default:a(()=>[t(S,null,{default:a(()=>[t(z(ge))]),_:1}),e[16]||(e[16]=n(" 重命名 ",-1))]),_:2,__:[16]},1032,["onClick"]),t(c,{size:"small",text:"",type:"danger",onClick:y=>Q(l)},{default:a(()=>[t(S,null,{default:a(()=>[t(z(ye))]),_:1}),e[17]||(e[17]=n(" 删除 ",-1))]),_:2,__:[17]},1032,["onClick"])]),_:1})]),_:1},8,["data"]),i("div",Ne,[t(ae,{"current-page":b.value,"onUpdate:currentPage":e[1]||(e[1]=l=>b.value=l),"page-size":U.value,"onUpdate:pageSize":e[2]||(e[2]=l=>U.value=l),"page-sizes":[10,20,50,100],total:N.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:A,onCurrentChange:q},null,8,["current-page","page-size","total"])])]),t(P,{modelValue:k.value,"onUpdate:modelValue":e[5]||(e[5]=l=>k.value=l),title:"脚本详情",width:"70%"},{footer:a(()=>[t(c,{onClick:e[3]||(e[3]=l=>k.value=!1)},{default:a(()=>e[19]||(e[19]=[n("关闭",-1)])),_:1,__:[19]}),t(c,{type:"primary",onClick:e[4]||(e[4]=l=>L(p.value))},{default:a(()=>e[20]||(e[20]=[n("编辑脚本",-1)])),_:1,__:[20]})]),default:a(()=>[p.value?(V(),M("div",De,[t(le,{column:2,border:""},{default:a(()=>[t(g,{label:"脚本名称",span:2},{default:a(()=>[n(s(p.value.name),1)]),_:1}),t(g,{label:"项目"},{default:a(()=>{var l;return[n(s(((l=p.value.project)==null?void 0:l.name)||"未知项目"),1)]}),_:1}),t(g,{label:"语言"},{default:a(()=>[n(s(E(p.value.language)),1)]),_:1}),t(g,{label:"框架"},{default:a(()=>[n(s($(p.value.framework)),1)]),_:1}),t(g,{label:"类型"},{default:a(()=>[n(s(X(p.value.script_type)),1)]),_:1}),t(g,{label:"创建时间",span:2},{default:a(()=>[n(s(j(p.value.created_at)),1)]),_:1}),t(g,{label:"更新时间",span:2},{default:a(()=>[n(s(j(p.value.updated_at)),1)]),_:1})]),_:1}),i("div",Me,[e[18]||(e[18]=i("h4",null,"脚本内容:",-1)),i("pre",Ue,s(p.value.content||"(无内容)"),1)])])):I("",!0)]),_:1},8,["modelValue"]),t(P,{modelValue:C.value,"onUpdate:modelValue":e[8]||(e[8]=l=>C.value=l),title:"重命名脚本",width:"400px"},{footer:a(()=>[t(c,{onClick:e[7]||(e[7]=l=>C.value=!1)},{default:a(()=>e[21]||(e[21]=[n("取消",-1)])),_:1,__:[21]}),t(c,{type:"primary",onClick:G},{default:a(()=>e[22]||(e[22]=[n("确定",-1)])),_:1,__:[22]})]),default:a(()=>[t(se,{model:m,"label-width":"80px"},{default:a(()=>[t(ne,{label:"新名称"},{default:a(()=>[t(oe,{modelValue:m.newName,"onUpdate:modelValue":e[6]||(e[6]=l=>m.newName=l),placeholder:"请输入新的脚本名称"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),t(P,{modelValue:x.value,"onUpdate:modelValue":e[11]||(e[11]=l=>x.value=l),title:"编辑脚本",width:"80%","close-on-click-modal":!1},{footer:a(()=>[t(c,{onClick:e[10]||(e[10]=l=>x.value=!1)},{default:a(()=>e[23]||(e[23]=[n("取消",-1)])),_:1,__:[23]}),t(c,{type:"primary",onClick:W,loading:B.value},{default:a(()=>e[24]||(e[24]=[n("保存",-1)])),_:1,__:[24]},8,["loading"])]),default:a(()=>[u.value?(V(),M("div",Be,[i("div",Ee,[i("span",$e,s(u.value.name),1),i("div",je,[t(D,{size:"small",type:u.value.language==="python"?"success":"primary"},{default:a(()=>[n(s(E(u.value.language)),1)]),_:1},8,["type"]),t(D,{size:"small",type:u.value.framework==="playwright"?"warning":"info",style:{"margin-left":"10px"}},{default:a(()=>[n(s($(u.value.framework)),1)]),_:1},8,["type"])])]),i("div",Pe,[we(i("textarea",{"onUpdate:modelValue":e[9]||(e[9]=l=>u.value.content=l),class:"code-editor",placeholder:"请输入脚本内容..."},null,512),[[be,u.value.content]])])])):I("",!0)]),_:1},8,["modelValue"])])}}},Je=re(Le,[["__scopeId","data-v-8e4546b2"]]);export{Je as default};
