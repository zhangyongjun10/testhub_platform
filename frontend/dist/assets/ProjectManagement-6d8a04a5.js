import{_ as _e,q as p,V as me,x as ce,E as Q,r as u,S as fe,o as m,c as V,b as X,d as a,w as l,N as ve,J as M,C as k,e as c,g as _,D as ge,f as r,t as i,F as B,y as $,aj as ye,ak as f,R as H}from"./index-054e2682.js";const be={class:"project-management"},we={class:"header"},Te={key:0},Ve={key:1},ke={__name:"ProjectManagement",setup(Ce){const R=p(!1),O=p([]),U=p([]),P=p(1),D=p(20),q=p(0),w=p(!1),x=p(!1),b=p(null),s=p(null),N=p(!1),E=p(),n=me({name:"",description:"",project_type:"HTTP",status:"NOT_STARTED",owner:null,member_ids:[],start_date:"",end_date:""}),Z={name:[{required:!0,message:"请输入项目名称",trigger:"blur"}],project_type:[{required:!0,message:"请选择项目类型",trigger:"change"}],status:[{required:!0,message:"请选择项目状态",trigger:"change"}],owner:[{required:!0,message:"请选择负责人",trigger:"change"}]},A=o=>({NOT_STARTED:"info",IN_PROGRESS:"warning",COMPLETED:"success"})[o]||"info",F=o=>({NOT_STARTED:"未开始",IN_PROGRESS:"进行中",COMPLETED:"已结束"})[o]||o,Y=o=>H(o).format("YYYY-MM-DD HH:mm"),T=async()=>{R.value=!0;try{const o=await k.get("/api-testing/projects/",{params:{page:P.value,page_size:D.value}});O.value=o.data.results,q.value=o.data.count}catch(o){c.error("加载项目列表失败"),console.error(o)}finally{R.value=!1}},h=async()=>{try{const o=await k.get("/api-testing/users/");U.value=o.data.results||o.data}catch(o){c.error("加载用户列表失败"),console.error(o)}},ee=async()=>{var o,t;try{await k.post("/api-testing/projects/create-sample/"),c.success("示例项目创建成功"),await T()}catch(S){(t=(o=S.response)==null?void 0:o.data)!=null&&t.message?c.warning(S.response.data.message):c.error("创建示例项目失败")}},te=o=>{D.value=o,T()},ae=o=>{P.value=o,T()},I=o=>{b.value=o,n.name=o.name,n.description=o.description,n.project_type=o.project_type,n.status=o.status,n.owner=o.owner.id,n.member_ids=o.members.map(t=>t.id),n.start_date=o.start_date,n.end_date=o.end_date,w.value=!0},le=o=>{x.value=!0,s.value=o},oe=async o=>{try{await Q.confirm(`确定要删除项目 "${o.name}" 吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await k.delete(`/api-testing/projects/${o.id}/`),c.success("删除成功"),await T()}catch(t){t!=="cancel"&&(c.error("删除失败"),console.error(t))}},ne=async()=>{if(!(!E.value||!await E.value.validate().catch(()=>!1))){N.value=!0;try{const t={...n};t.start_date&&(t.start_date=H(t.start_date).format("YYYY-MM-DD")),t.end_date&&(t.end_date=H(t.end_date).format("YYYY-MM-DD")),b.value?(await k.put(`/api-testing/projects/${b.value.id}/`,t),c.success("项目更新成功")):(await k.post("/api-testing/projects/",t),c.success("项目创建成功")),w.value=!1,await T()}catch(t){c.error(b.value?"更新项目失败":"创建项目失败"),console.error(t)}finally{N.value=!1}}},re=()=>{var o;b.value=null,Object.assign(n,{name:"",description:"",project_type:"HTTP",status:"NOT_STARTED",owner:null,member_ids:[],start_date:"",end_date:""}),(o=E.value)==null||o.resetFields()};return ce(async()=>{if(await Promise.all([T(),h()]),O.value.length===0)try{await Q.confirm("当前没有任何项目，是否创建宠物店示例项目？","提示",{confirmButtonText:"创建示例项目",cancelButtonText:"稍后再说",type:"info"}),await ee()}catch{}}),(o,t)=>{const S=u("el-icon"),v=u("el-button"),g=u("el-table-column"),C=u("el-tag"),se=u("el-table"),ue=u("el-pagination"),L=u("el-input"),y=u("el-form-item"),G=u("el-radio"),de=u("el-radio-group"),j=u("el-option"),z=u("el-select"),W=u("el-date-picker"),ie=u("el-form"),J=u("el-dialog"),pe=fe("loading");return m(),V("div",be,[X("div",we,[t[17]||(t[17]=X("h2",null,"项目管理",-1)),a(v,{type:"primary",onClick:t[0]||(t[0]=e=>w.value=!0)},{default:l(()=>[a(S,null,{default:l(()=>[a(_(ge))]),_:1}),t[16]||(t[16]=r(" 新建项目 ",-1))]),_:1,__:[16]})]),ve((m(),M(se,{data:O.value,style:{width:"100%"}},{default:l(()=>[a(g,{prop:"name",label:"项目名称","min-width":"200"}),a(g,{prop:"project_type",label:"项目类型",width:"120"},{default:l(e=>[a(C,{type:e.row.project_type==="HTTP"?"primary":"success"},{default:l(()=>[r(i(e.row.project_type),1)]),_:2},1032,["type"])]),_:1}),a(g,{prop:"status",label:"项目状态",width:"120"},{default:l(e=>[a(C,{type:A(e.row.status)},{default:l(()=>[r(i(F(e.row.status)),1)]),_:2},1032,["type"])]),_:1}),a(g,{prop:"owner.username",label:"负责人",width:"150"}),a(g,{prop:"start_date",label:"开始日期",width:"120"}),a(g,{prop:"end_date",label:"结束日期",width:"120"}),a(g,{prop:"created_at",label:"创建时间",width:"180"},{default:l(e=>[r(i(Y(e.row.created_at)),1)]),_:1}),a(g,{label:"操作",width:"200"},{default:l(e=>[a(v,{link:"",type:"primary",onClick:d=>I(e.row)},{default:l(()=>t[18]||(t[18]=[r("编辑",-1)])),_:2,__:[18]},1032,["onClick"]),a(v,{link:"",type:"primary",onClick:d=>le(e.row)},{default:l(()=>t[19]||(t[19]=[r("查看",-1)])),_:2,__:[19]},1032,["onClick"]),a(v,{link:"",type:"danger",onClick:d=>oe(e.row)},{default:l(()=>t[20]||(t[20]=[r("删除",-1)])),_:2,__:[20]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[pe,R.value]]),a(ue,{"current-page":P.value,"onUpdate:currentPage":t[1]||(t[1]=e=>P.value=e),"page-size":D.value,"onUpdate:pageSize":t[2]||(t[2]=e=>D.value=e),"page-sizes":[10,20,50,100],total:q.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:te,onCurrentChange:ae,class:"pagination"},null,8,["current-page","page-size","total"]),a(J,{modelValue:w.value,"onUpdate:modelValue":t[12]||(t[12]=e=>w.value=e),title:b.value?"编辑项目":"新建项目",width:"600px",onClose:re},{footer:l(()=>[a(v,{onClick:t[11]||(t[11]=e=>w.value=!1)},{default:l(()=>t[23]||(t[23]=[r("取消",-1)])),_:1,__:[23]}),a(v,{type:"primary",onClick:ne,loading:N.value},{default:l(()=>[r(i(b.value?"更新":"创建"),1)]),_:1},8,["loading"])]),default:l(()=>[a(ie,{ref_key:"formRef",ref:E,model:n,rules:Z,"label-width":"100px"},{default:l(()=>[a(y,{label:"项目名称",prop:"name"},{default:l(()=>[a(L,{modelValue:n.name,"onUpdate:modelValue":t[3]||(t[3]=e=>n.name=e),placeholder:"请输入项目名称"},null,8,["modelValue"])]),_:1}),a(y,{label:"项目描述",prop:"description"},{default:l(()=>[a(L,{modelValue:n.description,"onUpdate:modelValue":t[4]||(t[4]=e=>n.description=e),type:"textarea",rows:3,placeholder:"请输入项目描述"},null,8,["modelValue"])]),_:1}),a(y,{label:"项目类型",prop:"project_type"},{default:l(()=>[a(de,{modelValue:n.project_type,"onUpdate:modelValue":t[5]||(t[5]=e=>n.project_type=e)},{default:l(()=>[a(G,{value:"HTTP"},{default:l(()=>t[21]||(t[21]=[r("HTTP",-1)])),_:1,__:[21]}),a(G,{value:"WEBSOCKET"},{default:l(()=>t[22]||(t[22]=[r("WebSocket",-1)])),_:1,__:[22]})]),_:1},8,["modelValue"])]),_:1}),a(y,{label:"项目状态",prop:"status"},{default:l(()=>[a(z,{modelValue:n.status,"onUpdate:modelValue":t[6]||(t[6]=e=>n.status=e),placeholder:"请选择项目状态"},{default:l(()=>[a(j,{label:"未开始",value:"NOT_STARTED"}),a(j,{label:"进行中",value:"IN_PROGRESS"}),a(j,{label:"已结束",value:"COMPLETED"})]),_:1},8,["modelValue"])]),_:1}),a(y,{label:"负责人",prop:"owner"},{default:l(()=>[a(z,{modelValue:n.owner,"onUpdate:modelValue":t[7]||(t[7]=e=>n.owner=e),placeholder:"请选择负责人",filterable:""},{default:l(()=>[(m(!0),V(B,null,$(U.value,e=>(m(),M(j,{key:e.id,label:e.username,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(y,{label:"团队成员",prop:"member_ids"},{default:l(()=>[a(z,{modelValue:n.member_ids,"onUpdate:modelValue":t[8]||(t[8]=e=>n.member_ids=e),multiple:"",placeholder:"请选择团队成员",filterable:""},{default:l(()=>[(m(!0),V(B,null,$(U.value,e=>(m(),M(j,{key:e.id,label:e.username,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(y,{label:"开始日期",prop:"start_date"},{default:l(()=>[a(W,{modelValue:n.start_date,"onUpdate:modelValue":t[9]||(t[9]=e=>n.start_date=e),type:"date",placeholder:"请选择开始日期",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),a(y,{label:"结束日期",prop:"end_date"},{default:l(()=>[a(W,{modelValue:n.end_date,"onUpdate:modelValue":t[10]||(t[10]=e=>n.end_date=e),type:"date",placeholder:"请选择结束日期",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),a(J,{modelValue:x.value,"onUpdate:modelValue":t[15]||(t[15]=e=>x.value=e),title:"项目详情",width:"600px"},{footer:l(()=>[a(v,{onClick:t[13]||(t[13]=e=>x.value=!1)},{default:l(()=>t[24]||(t[24]=[r("关闭",-1)])),_:1,__:[24]}),a(v,{type:"primary",onClick:t[14]||(t[14]=e=>I(s.value))},{default:l(()=>t[25]||(t[25]=[r("编辑",-1)])),_:1,__:[25]})]),default:l(()=>[a(_(ye),{column:1,border:""},{default:l(()=>[a(_(f),{label:"项目名称"},{default:l(()=>{var e;return[r(i((e=s.value)==null?void 0:e.name),1)]}),_:1}),a(_(f),{label:"项目描述"},{default:l(()=>{var e;return[r(i(((e=s.value)==null?void 0:e.description)||"无"),1)]}),_:1}),a(_(f),{label:"项目类型"},{default:l(()=>{var e;return[a(C,{type:((e=s.value)==null?void 0:e.project_type)==="HTTP"?"primary":"success"},{default:l(()=>{var d;return[r(i((d=s.value)==null?void 0:d.project_type),1)]}),_:1},8,["type"])]}),_:1}),a(_(f),{label:"项目状态"},{default:l(()=>{var e;return[a(C,{type:A((e=s.value)==null?void 0:e.status)},{default:l(()=>{var d;return[r(i(F((d=s.value)==null?void 0:d.status)),1)]}),_:1},8,["type"])]}),_:1}),a(_(f),{label:"负责人"},{default:l(()=>{var e,d;return[r(i((d=(e=s.value)==null?void 0:e.owner)==null?void 0:d.username),1)]}),_:1}),a(_(f),{label:"团队成员"},{default:l(()=>{var e,d;return[(d=(e=s.value)==null?void 0:e.members)!=null&&d.length?(m(),V("div",Te,[(m(!0),V(B,null,$(s.value.members,K=>(m(),M(C,{key:K.id,size:"small",style:{"margin-right":"5px","margin-bottom":"5px"}},{default:l(()=>[r(i(K.username),1)]),_:2},1024))),128))])):(m(),V("span",Ve,"无"))]}),_:1}),a(_(f),{label:"开始日期"},{default:l(()=>{var e;return[r(i(((e=s.value)==null?void 0:e.start_date)||"未设置"),1)]}),_:1}),a(_(f),{label:"结束日期"},{default:l(()=>{var e;return[r(i(((e=s.value)==null?void 0:e.end_date)||"未设置"),1)]}),_:1}),a(_(f),{label:"创建时间"},{default:l(()=>{var e;return[r(i(Y((e=s.value)==null?void 0:e.created_at)),1)]}),_:1}),a(_(f),{label:"更新时间"},{default:l(()=>{var e;return[r(i(Y((e=s.value)==null?void 0:e.updated_at)),1)]}),_:1})]),_:1})]),_:1},8,["modelValue"])])}}},Pe=_e(ke,[["__scopeId","data-v-e8212a98"]]);export{Pe as default};
