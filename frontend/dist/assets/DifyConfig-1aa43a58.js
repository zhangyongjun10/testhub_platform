import{_ as S,q as y,x as q,r as n,o as b,c as E,b as r,d as a,w as l,J as C,B as M,C as w,f as u,g as m,l as T,cQ as h,t as c,cR as z,W as J,cS as Q,e as p}from"./index-054e2682.js";const W={class:"dify-config-container"},$={class:"config-content"},j={class:"card-header"},G={class:"switch-label"},H={__name:"DifyConfig",setup(O){const d=y(null),o=y(null),I=y(!1),g=y(!1),t=y({api_url:"",api_key:"",is_active:!0}),U={api_url:[{required:!0,message:"è¯·è¾“å…¥API URL",trigger:"blur"},{type:"url",message:"è¯·è¾“å…¥æœ‰æ•ˆçš„URL",trigger:"blur"}],api_key:[{min:8,message:"API Keyé•¿åº¦è‡³å°‘8ä½",trigger:"blur"}]},P=i=>i?new Date(i).toLocaleString("zh-CN"):"-",V=async()=>{var i;try{const e=await w.get("/assistant/config/dify/");o.value=e.data,t.value={api_url:e.data.api_url,api_key:"",is_active:e.data.is_active}}catch(e){((i=e.response)==null?void 0:i.status)!==404&&console.error("åŠ è½½é…ç½®å¤±è´¥:",e)}},K=async()=>{d.value&&await d.value.validate(async i=>{var e,_;if(i){I.value=!0;try{const s=await w.post("/assistant/config/dify/test_connection/",{api_url:t.value.api_url,api_key:t.value.api_key});s.data.success?p.success("è¿žæŽ¥æµ‹è¯•æˆåŠŸï¼"):p.error(s.data.error||"è¿žæŽ¥æµ‹è¯•å¤±è´¥")}catch(s){console.error("æµ‹è¯•è¿žæŽ¥å¤±è´¥:",s),p.error(((_=(e=s.response)==null?void 0:e.data)==null?void 0:_.error)||"è¿žæŽ¥æµ‹è¯•å¤±è´¥")}finally{I.value=!1}}})},L=async()=>{d.value&&await d.value.validate(async i=>{var e,_;if(i){g.value=!0;try{const s={api_url:t.value.api_url,is_active:t.value.is_active};if(t.value.api_key&&t.value.api_key.trim()&&(s.api_key=t.value.api_key),o.value)await w.patch(`/assistant/config/dify/${o.value.id}/`,s),p.success("é…ç½®æ›´æ–°æˆåŠŸï¼");else{if(!t.value.api_key||!t.value.api_key.trim()){p.error("åˆ›å»ºæ–°é…ç½®æ—¶API Keyæ˜¯å¿…å¡«é¡¹"),g.value=!1;return}await w.post("/assistant/config/dify/",s),p.success("é…ç½®ä¿å­˜æˆåŠŸï¼")}t.value.api_key="",await V()}catch(s){console.error("ä¿å­˜é…ç½®å¤±è´¥:",s),p.error(((_=(e=s.response)==null?void 0:e.data)==null?void 0:_.error)||"ä¿å­˜é…ç½®å¤±è´¥")}finally{g.value=!1}}})},R=()=>{d.value&&d.value.resetFields(),o.value&&(t.value={api_url:o.value.api_url,api_key:"",is_active:o.value.is_active})};return q(()=>{V()}),(i,e)=>{const _=n("el-tag"),s=n("el-icon"),D=n("el-input"),k=n("el-form-item"),B=n("el-switch"),A=n("el-button"),N=n("el-form"),x=n("el-card"),f=n("el-descriptions-item"),F=n("el-descriptions");return b(),E("div",W,[e[12]||(e[12]=r("div",{class:"page-header"},[r("h1",null,"ðŸ¤– AIè¯„æµ‹å¸ˆé…ç½®"),r("p",null,"é…ç½®Dify APIä»¥å¯ç”¨AIè¯„æµ‹å¸ˆåŠŸèƒ½")],-1)),r("div",$,[a(x,{class:"config-card"},{header:l(()=>[r("div",j,[e[5]||(e[5]=r("span",null,"Dify APIé…ç½®",-1)),o.value?(b(),C(_,{key:0,type:"success"},{default:l(()=>e[3]||(e[3]=[u("å·²é…ç½®",-1)])),_:1,__:[3]})):(b(),C(_,{key:1,type:"info"},{default:l(()=>e[4]||(e[4]=[u("æœªé…ç½®",-1)])),_:1,__:[4]}))])]),default:l(()=>[a(N,{model:t.value,rules:U,ref_key:"configForm",ref:d,"label-width":"120px"},{default:l(()=>[a(k,{label:"API URL",prop:"api_url"},{default:l(()=>[a(D,{modelValue:t.value.api_url,"onUpdate:modelValue":e[0]||(e[0]=v=>t.value.api_url=v),placeholder:"https://api.dify.ai/v1",clearable:""},{prepend:l(()=>[a(s,null,{default:l(()=>[a(m(T))]),_:1})]),_:1},8,["modelValue"]),e[6]||(e[6]=r("div",{class:"form-tip"},"Dify APIçš„å®Œæ•´URLåœ°å€",-1))]),_:1,__:[6]}),a(k,{label:"API Key",prop:"api_key"},{default:l(()=>[a(D,{modelValue:t.value.api_key,"onUpdate:modelValue":e[1]||(e[1]=v=>t.value.api_key=v),type:"password",placeholder:o.value?"ç•™ç©ºåˆ™ä¸ä¿®æ”¹API Key":"è¯·è¾“å…¥API Key","show-password":"",clearable:""},{prepend:l(()=>[a(s,null,{default:l(()=>[a(m(h))]),_:1})]),_:1},8,["modelValue","placeholder"]),e[7]||(e[7]=r("div",{class:"form-tip"},"ä»ŽDifyå¹³å°èŽ·å–çš„APIå¯†é’¥",-1))]),_:1,__:[7]}),a(k,{label:"å¯ç”¨çŠ¶æ€",prop:"is_active"},{default:l(()=>[a(B,{modelValue:t.value.is_active,"onUpdate:modelValue":e[2]||(e[2]=v=>t.value.is_active=v)},null,8,["modelValue"]),r("span",G,c(t.value.is_active?"å·²å¯ç”¨":"å·²ç¦ç”¨"),1)]),_:1}),a(k,null,{default:l(()=>[a(A,{type:"primary",onClick:K,loading:I.value},{default:l(()=>[a(s,null,{default:l(()=>[a(m(z))]),_:1}),e[8]||(e[8]=u(" æµ‹è¯•è¿žæŽ¥ ",-1))]),_:1,__:[8]},8,["loading"]),a(A,{type:"success",onClick:L,loading:g.value},{default:l(()=>[a(s,null,{default:l(()=>[a(m(J))]),_:1}),e[9]||(e[9]=u(" ä¿å­˜é…ç½® ",-1))]),_:1,__:[9]},8,["loading"]),a(A,{onClick:R},{default:l(()=>[a(s,null,{default:l(()=>[a(m(Q))]),_:1}),e[10]||(e[10]=u(" é‡ç½® ",-1))]),_:1,__:[10]})]),_:1})]),_:1},8,["model"])]),_:1}),o.value?(b(),C(x,{key:0,class:"info-card"},{header:l(()=>e[11]||(e[11]=[r("span",null,"å½“å‰é…ç½®ä¿¡æ¯",-1)])),default:l(()=>[a(F,{column:1,border:""},{default:l(()=>[a(f,{label:"API URL"},{default:l(()=>[u(c(o.value.api_url),1)]),_:1}),a(f,{label:"API Key"},{default:l(()=>[u(c(o.value.api_key_masked||"****"),1)]),_:1}),a(f,{label:"çŠ¶æ€"},{default:l(()=>[a(_,{type:o.value.is_active?"success":"info"},{default:l(()=>[u(c(o.value.is_active?"å·²å¯ç”¨":"å·²ç¦ç”¨"),1)]),_:1},8,["type"])]),_:1}),a(f,{label:"åˆ›å»ºæ—¶é—´"},{default:l(()=>[u(c(P(o.value.created_at)),1)]),_:1}),a(f,{label:"æ›´æ–°æ—¶é—´"},{default:l(()=>[u(c(P(o.value.updated_at)),1)]),_:1})]),_:1})]),_:1})):M("",!0)])])}}},Y=S(H,[["__scopeId","data-v-4720fe66"]]);export{Y as default};
