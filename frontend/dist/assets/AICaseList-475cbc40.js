import{_ as Z,u as ee,q as r,V as B,x as te,r as s,S as ae,o as b,c as E,b as c,d as t,w as l,N as oe,J as j,e as d,F as le,y as ne,g as k,U as se,af as re,f as g,ae as ie,H as de,E as ue}from"./index-644940f8.js";import{b as ce,a1 as pe,a2 as _e,a3 as me,a4 as fe}from"./ui_automation-3c95efdb.js";const ge={class:"page-container"},ve={class:"page-header"},ye={class:"card-container"},Ce={class:"filter-bar"},we={class:"pagination-container"},be={class:"dialog-footer"},ke={__name:"AICaseList",setup(he){const D=ee(),v=r([]),p=r(""),P=r([]),h=r(!1),x=r(""),S=r(0),i=B({currentPage:1,pageSize:20}),_=r(!1),V=r(!1),U=r(null),n=B({name:"",description:"",task_description:""}),z=r(null),F={name:[{required:!0,message:"请输入用例名称",trigger:"blur"}],task_description:[{required:!0,message:"请输入任务描述",trigger:"blur"}]},L=async()=>{try{const o=await ce({page_size:100});v.value=o.data.results||o.data,v.value.length>0&&(p.value=v.value[0].id,u())}catch(o){console.error("获取项目列表失败:",o),d.error("获取项目列表失败")}},N=()=>{i.currentPage=1,u()},u=async()=>{if(p.value){h.value=!0;try{const o=await pe({project:p.value,page:i.currentPage,page_size:i.pageSize,search:x.value});P.value=o.data.results||[],S.value=o.data.count||0}catch(o){console.error("获取用例列表失败:",o),d.error("获取用例列表失败")}finally{h.value=!1}}},R=()=>{i.currentPage=1,u()},T=()=>{i.currentPage=1,u()},$=()=>{u()},q=o=>{U.value=o.id,n.name=o.name,n.description=o.description,n.task_description=o.task_description,_.value=!0},M=async()=>{z.value&&await z.value.validate(async o=>{if(o){V.value=!0;try{await _e(U.value,{name:n.name,description:n.description,task_description:n.task_description}),d.success("更新成功"),_.value=!1,u()}catch(e){console.error("更新失败:",e),d.error("更新失败")}finally{V.value=!1}}})},H=async o=>{try{await ue.confirm("确定要删除该用例吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await me(o),d.success("删除成功"),u()}catch(e){e!=="cancel"&&(console.error("删除失败:",e),d.error("删除失败"))}},J=async o=>{try{await fe(o.id),d.success("用例开始执行"),D.push("/ai-intelligent-mode/execution-records")}catch(e){console.error("执行失败:",e),d.error("执行失败")}},G=(o,e,y)=>y?new Date(y).toLocaleString():"";return te(()=>{L()}),(o,e)=>{const y=s("el-option"),K=s("el-select"),C=s("el-icon"),w=s("el-input"),m=s("el-table-column"),f=s("el-button"),O=s("el-table"),Q=s("el-pagination"),I=s("el-form-item"),W=s("el-form"),X=s("el-dialog"),Y=ae("loading");return b(),E("div",ge,[c("div",ve,[e[9]||(e[9]=c("h1",{class:"page-title"},"AI 用例管理",-1)),t(K,{modelValue:p.value,"onUpdate:modelValue":e[0]||(e[0]=a=>p.value=a),placeholder:"选择项目",style:{width:"200px","margin-right":"15px"},onChange:N},{default:l(()=>[(b(!0),E(le,null,ne(v.value,a=>(b(),j(y,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),c("div",ye,[c("div",Ce,[t(w,{modelValue:x.value,"onUpdate:modelValue":e[1]||(e[1]=a=>x.value=a),placeholder:"搜索用例名称或描述",clearable:"",onInput:R,style:{width:"300px"}},{prefix:l(()=>[t(C,null,{default:l(()=>[t(k(se))]),_:1})]),_:1},8,["modelValue"])]),oe((b(),j(O,{data:P.value,style:{width:"100%"}},{default:l(()=>[t(m,{prop:"name",label:"用例名称","min-width":"200","show-overflow-tooltip":""}),t(m,{prop:"description",label:"描述","min-width":"200","show-overflow-tooltip":""}),t(m,{prop:"task_description",label:"任务描述","min-width":"300","show-overflow-tooltip":""}),t(m,{prop:"created_at",label:"创建时间",width:"180",formatter:G}),t(m,{label:"操作",width:"200",fixed:"right"},{default:l(({row:a})=>[t(f,{size:"small",type:"success",onClick:A=>J(a)},{default:l(()=>[t(C,null,{default:l(()=>[t(k(re))]),_:1}),e[10]||(e[10]=g(" 执行 ",-1))]),_:2,__:[10]},1032,["onClick"]),t(f,{size:"small",type:"primary",onClick:A=>q(a)},{default:l(()=>[t(C,null,{default:l(()=>[t(k(ie))]),_:1}),e[11]||(e[11]=g(" 编辑 ",-1))]),_:2,__:[11]},1032,["onClick"]),t(f,{size:"small",type:"danger",onClick:A=>H(a.id)},{default:l(()=>[t(C,null,{default:l(()=>[t(k(de))]),_:1}),e[12]||(e[12]=g(" 删除 ",-1))]),_:2,__:[12]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[Y,h.value]]),c("div",we,[t(Q,{"current-page":i.currentPage,"onUpdate:currentPage":e[2]||(e[2]=a=>i.currentPage=a),"page-size":i.pageSize,"onUpdate:pageSize":e[3]||(e[3]=a=>i.pageSize=a),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:S.value,onSizeChange:T,onCurrentChange:$},null,8,["current-page","page-size","total"])])]),t(X,{modelValue:_.value,"onUpdate:modelValue":e[8]||(e[8]=a=>_.value=a),title:"编辑 AI 用例",width:"600px"},{footer:l(()=>[c("span",be,[t(f,{onClick:e[7]||(e[7]=a=>_.value=!1)},{default:l(()=>e[13]||(e[13]=[g("取消",-1)])),_:1,__:[13]}),t(f,{type:"primary",onClick:M,loading:V.value},{default:l(()=>e[14]||(e[14]=[g("保存",-1)])),_:1,__:[14]},8,["loading"])])]),default:l(()=>[t(W,{model:n,rules:F,ref_key:"editFormRef",ref:z,"label-width":"100px"},{default:l(()=>[t(I,{label:"用例名称",prop:"name"},{default:l(()=>[t(w,{modelValue:n.name,"onUpdate:modelValue":e[4]||(e[4]=a=>n.name=a),placeholder:"请输入用例名称"},null,8,["modelValue"])]),_:1}),t(I,{label:"描述",prop:"description"},{default:l(()=>[t(w,{modelValue:n.description,"onUpdate:modelValue":e[5]||(e[5]=a=>n.description=a),type:"textarea",placeholder:"请输入用例描述"},null,8,["modelValue"])]),_:1}),t(I,{label:"任务描述",prop:"task_description"},{default:l(()=>[t(w,{modelValue:n.task_description,"onUpdate:modelValue":e[6]||(e[6]=a=>n.task_description=a),type:"textarea",rows:6,placeholder:"请输入自然语言任务描述"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},ze=Z(ke,[["__scopeId","data-v-3d7582de"]]);export{ze as default};
