import{_ as ve,q as f,V as fe,x as ge,r as u,S as me,o as d,c as _,b as o,d as e,w as a,N as he,J as V,e as x,F as N,y as M,g as C,ao as ye,f as r,t as n,a2 as be,H as we,B as D,a5 as Y,E as ke}from"./index-054e2682.js";import{b as xe,O as Ce,P as De}from"./ui_automation-53e326f9.js";const Se={class:"report-view"},ze={class:"header"},Ee={class:"actions"},Pe={class:"content"},Ve={style:{color:"#67c23a","font-weight":"bold"}},Ne={style:{color:"#f56c6c","font-weight":"bold"}},Me={class:"pagination-container"},Te={key:0,class:"report-detail"},Re={class:"statistics-section"},Be={class:"stat-card"},Ue={class:"stat-value"},$e={class:"stat-card success"},Ie={class:"stat-value"},Fe={class:"stat-card danger"},Le={class:"stat-value"},je={class:"stat-card warning"},Ae={class:"stat-value"},Ge={class:"pass-rate-chart"},Oe={class:"result-section"},qe={key:0,class:"error-section"},He={class:"errors-container"},Je={class:"error-item"},Ke={class:"error-content"},Qe={class:"error-text"},We={key:0,class:"case-detail"},Xe={key:0},Ye={class:"log-container"},Ze={class:"log-header"},et={class:"log-action"},tt={class:"log-desc"},st={key:0,class:"log-error"},at={key:1},lt={class:"log-container"},ot={class:"log-header"},nt={class:"log-action"},rt={class:"log-desc"},it={key:0,class:"log-error"},dt={key:0,class:"screenshot-container"},ct=["src","alt"],ut={class:"screenshot-time"},_t={class:"errors-container"},pt={key:0,class:"error-item"},vt={class:"error-content"},ft={class:"error-text"},gt={__name:"ReportList",setup(mt){const T=f([]),S=f([]),w=f(""),R=f(!1),B=f(0),m=fe({currentPage:1,pageSize:20}),z=f(!1),i=f(null),E=f(!1),p=f(null),U=f("logs"),Z=async()=>{try{const l=await xe({page_size:100});S.value=l.data.results||l.data}catch(l){console.error("获取项目列表失败:",l),x.error("获取项目列表失败")}},h=async()=>{R.value=!0;try{const l={page:m.currentPage,page_size:m.pageSize};w.value&&(l.project=w.value);const s=await Ce(l);s.data.results?(T.value=s.data.results,B.value=s.data.count||0):(T.value=s.data,B.value=s.data.length)}catch(l){console.error("加载测试报告失败:",l),x.error("加载测试报告失败")}finally{R.value=!1}},ee=async()=>{m.currentPage=1,await h()},te=async()=>{await h(),x.success("报告已刷新")},se=async()=>{m.currentPage=1,await h()},ae=async()=>{await h()},le=l=>{i.value=l,z.value=!0},oe=l=>!l||!l.result_data||!l.result_data.test_cases?[]:l.result_data.test_cases,ne=l=>{p.value=l,U.value="logs",E.value=!0},L=l=>({click:"点击",fill:"填写",getText:"获取文本",waitFor:"等待元素",hover:"悬停",scroll:"滚动",screenshot:"截图",assert:"断言",wait:"等待"})[l]||l,re=async l=>{try{await ke.confirm(`确定要删除报告"${l.test_suite_name}"吗？此操作不可恢复。`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await De(l.id),x.success("删除成功"),await h()}catch(s){s!=="cancel"&&(console.error("删除报告失败:",s),x.error("删除报告失败"))}},j=l=>({PENDING:"info",RUNNING:"warning",SUCCESS:"success",FAILED:"danger",ABORTED:"info"})[l]||"info",A=l=>({PENDING:"待执行",RUNNING:"执行中",SUCCESS:"成功",FAILED:"失败",ABORTED:"中止"})[l]||l,G=l=>({playwright:"Playwright",selenium:"Selenium"})[l]||l||"Playwright",O=l=>({chrome:"Chrome",firefox:"Firefox",safari:"Safari",edge:"Edge"})[l]||l||"Chrome",q=l=>l>=80?"#67c23a":l>=60?"#e6a23c":"#f56c6c",$=l=>l?new Date(l).toLocaleString():"-",H=l=>{if(!l)return"0秒";if(l<60)return`${l.toFixed(1)}秒`;const s=Math.floor(l/60),I=(l%60).toFixed(0);return`${s}分${I}秒`};return ge(async()=>{await Z(),S.value.length>0&&(w.value=S.value[0].id),await h()}),(l,s)=>{var X;const I=u("el-option"),ie=u("el-select"),k=u("el-icon"),y=u("el-button"),c=u("el-table-column"),b=u("el-tag"),J=u("el-progress"),K=u("el-table"),de=u("el-pagination"),v=u("el-descriptions-item"),ce=u("el-descriptions"),P=u("el-col"),ue=u("el-row"),Q=u("el-dialog"),F=u("el-tab-pane"),W=u("el-empty"),_e=u("el-tabs"),pe=me("loading");return d(),_("div",Se,[o("div",ze,[s[9]||(s[9]=o("h3",null,"测试报告",-1)),o("div",Ee,[e(ie,{modelValue:w.value,"onUpdate:modelValue":s[0]||(s[0]=t=>w.value=t),placeholder:"选择项目",style:{width:"200px","margin-right":"15px"},onChange:ee},{default:a(()=>[(d(!0),_(N,null,M(S.value,t=>(d(),V(I,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),e(y,{type:"primary",onClick:te},{default:a(()=>[e(k,null,{default:a(()=>[e(C(ye))]),_:1}),s[8]||(s[8]=r(" 刷新报告 ",-1))]),_:1,__:[8]})])]),o("div",Pe,[he((d(),V(K,{data:T.value,style:{width:"100%"}},{default:a(()=>[e(c,{prop:"id",label:"ID",width:"80"}),e(c,{prop:"test_suite_name",label:"测试套件","min-width":"200"}),e(c,{prop:"status",label:"状态",width:"120"},{default:a(({row:t})=>[e(b,{type:j(t.status)},{default:a(()=>[r(n(A(t.status)),1)]),_:2},1032,["type"])]),_:1}),e(c,{label:"测试引擎",width:"120"},{default:a(({row:t})=>[e(b,{size:"small"},{default:a(()=>[r(n(G(t.engine)),1)]),_:2},1024)]),_:1}),e(c,{label:"浏览器",width:"100"},{default:a(({row:t})=>[r(n(O(t.browser)),1)]),_:1}),e(c,{prop:"total_cases",label:"总用例数",width:"100"}),e(c,{prop:"passed_cases",label:"通过数",width:"100"},{default:a(({row:t})=>[o("span",Ve,n(t.passed_cases),1)]),_:1}),e(c,{prop:"failed_cases",label:"失败数",width:"100"},{default:a(({row:t})=>[o("span",Ne,n(t.failed_cases),1)]),_:1}),e(c,{label:"通过率",width:"100"},{default:a(({row:t})=>[e(J,{percentage:t.pass_rate,color:q(t.pass_rate),"stroke-width":16},null,8,["percentage","color"])]),_:1}),e(c,{label:"执行时长",width:"120"},{default:a(({row:t})=>[r(n(H(t.duration)),1)]),_:1}),e(c,{prop:"executed_by_name",label:"执行者",width:"120"}),e(c,{prop:"created_at",label:"执行时间",width:"180"},{default:a(({row:t})=>[r(n($(t.created_at)),1)]),_:1}),e(c,{label:"操作",width:"200",fixed:"right"},{default:a(({row:t})=>[e(y,{link:"",type:"primary",size:"small",onClick:g=>le(t)},{default:a(()=>[e(k,null,{default:a(()=>[e(C(be))]),_:1}),s[10]||(s[10]=r(" 查看详情 ",-1))]),_:2,__:[10]},1032,["onClick"]),e(y,{link:"",type:"danger",size:"small",onClick:g=>re(t)},{default:a(()=>[e(k,null,{default:a(()=>[e(C(we))]),_:1}),s[11]||(s[11]=r(" 删除 ",-1))]),_:2,__:[11]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[pe,R.value]]),o("div",Me,[e(de,{"current-page":m.currentPage,"onUpdate:currentPage":s[1]||(s[1]=t=>m.currentPage=t),"page-size":m.pageSize,"onUpdate:pageSize":s[2]||(s[2]=t=>m.pageSize=t),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:B.value,onSizeChange:se,onCurrentChange:ae},null,8,["current-page","page-size","total"])])]),e(Q,{modelValue:z.value,"onUpdate:modelValue":s[4]||(s[4]=t=>z.value=t),title:"测试报告详情",width:"80%","close-on-click-modal":!1},{footer:a(()=>[e(y,{onClick:s[3]||(s[3]=t=>z.value=!1)},{default:a(()=>s[20]||(s[20]=[r("关闭",-1)])),_:1,__:[20]})]),default:a(()=>[i.value?(d(),_("div",Te,[e(ce,{column:2,border:""},{default:a(()=>[e(v,{label:"报告ID"},{default:a(()=>[r(n(i.value.id),1)]),_:1}),e(v,{label:"测试套件"},{default:a(()=>[r(n(i.value.test_suite_name),1)]),_:1}),e(v,{label:"执行状态"},{default:a(()=>[e(b,{type:j(i.value.status)},{default:a(()=>[r(n(A(i.value.status)),1)]),_:1},8,["type"])]),_:1}),e(v,{label:"执行者"},{default:a(()=>[r(n(i.value.executed_by_name),1)]),_:1}),e(v,{label:"测试引擎"},{default:a(()=>[r(n(G(i.value.engine)),1)]),_:1}),e(v,{label:"浏览器"},{default:a(()=>[r(n(O(i.value.browser)),1)]),_:1}),e(v,{label:"执行模式"},{default:a(()=>[r(n(i.value.headless?"无头模式":"有头模式"),1)]),_:1}),e(v,{label:"执行时长"},{default:a(()=>[r(n(H(i.value.duration)),1)]),_:1}),e(v,{label:"开始时间"},{default:a(()=>[r(n($(i.value.started_at)),1)]),_:1}),e(v,{label:"结束时间"},{default:a(()=>[r(n($(i.value.finished_at)),1)]),_:1})]),_:1}),o("div",Re,[s[16]||(s[16]=o("h4",null,"测试统计",-1)),e(ue,{gutter:20},{default:a(()=>[e(P,{span:6},{default:a(()=>[o("div",Be,[s[12]||(s[12]=o("div",{class:"stat-label"},"总用例数",-1)),o("div",Ue,n(i.value.total_cases),1)])]),_:1}),e(P,{span:6},{default:a(()=>[o("div",$e,[s[13]||(s[13]=o("div",{class:"stat-label"},"通过数",-1)),o("div",Ie,n(i.value.passed_cases),1)])]),_:1}),e(P,{span:6},{default:a(()=>[o("div",Fe,[s[14]||(s[14]=o("div",{class:"stat-label"},"失败数",-1)),o("div",Le,n(i.value.failed_cases),1)])]),_:1}),e(P,{span:6},{default:a(()=>[o("div",je,[s[15]||(s[15]=o("div",{class:"stat-label"},"跳过数",-1)),o("div",Ae,n(i.value.skipped_cases),1)])]),_:1})]),_:1}),o("div",Ge,[o("h5",null,"通过率: "+n(i.value.pass_rate)+"%",1),e(J,{percentage:i.value.pass_rate,color:q(i.value.pass_rate),"stroke-width":20},null,8,["percentage","color"])])]),o("div",Oe,[s[18]||(s[18]=o("h4",null,"执行结果详情",-1)),e(K,{data:oe(i.value),border:"",style:{"margin-top":"15px"}},{default:a(()=>[e(c,{type:"index",label:"序号",width:"60"}),e(c,{prop:"test_case_name",label:"测试用例","min-width":"200"}),e(c,{label:"执行状态",width:"100",align:"center"},{default:a(({row:t})=>[e(b,{type:t.status==="passed"?"success":"danger"},{default:a(()=>[r(n(t.status==="passed"?"成功":"失败"),1)]),_:2},1032,["type"])]),_:1}),e(c,{label:"步骤数",width:"100",align:"center"},{default:a(({row:t})=>[r(n(t.steps?t.steps.length:0),1)]),_:1}),e(c,{label:"操作",width:"120",align:"center"},{default:a(({row:t})=>[e(y,{type:"primary",link:"",onClick:g=>ne(t)},{default:a(()=>s[17]||(s[17]=[r(" 查看详情 ",-1)])),_:2,__:[17]},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),i.value.error_message?(d(),_("div",qe,[s[19]||(s[19]=o("h4",null,"错误信息",-1)),o("div",He,[o("div",Je,[o("div",Ke,[o("pre",Qe,n(i.value.error_message),1)])])])])):D("",!0)])):D("",!0)]),_:1},8,["modelValue"]),e(Q,{modelValue:E.value,"onUpdate:modelValue":s[7]||(s[7]=t=>E.value=t),title:`用例详情 - ${((X=p.value)==null?void 0:X.test_case_name)||""}`,width:"900px","close-on-click-modal":!1},{footer:a(()=>[e(y,{onClick:s[6]||(s[6]=t=>E.value=!1)},{default:a(()=>s[22]||(s[22]=[r("关闭",-1)])),_:1,__:[22]})]),default:a(()=>[p.value?(d(),_("div",We,[p.value.status==="passed"?(d(),_("div",Xe,[s[21]||(s[21]=o("h4",null,"执行日志",-1)),o("div",Ye,[(d(!0),_(N,null,M(p.value.steps,(t,g)=>(d(),_("div",{key:g,class:"log-item"},[o("div",Ze,[e(b,{type:t.success?"success":"danger",size:"small"},{default:a(()=>[r(" 步骤 "+n(t.step_number),1)]),_:2},1032,["type"]),o("span",et,n(L(t.action_type)),1),o("span",tt,n(t.description),1)]),t.error?(d(),_("div",st,[e(k,null,{default:a(()=>[e(C(Y))]),_:1}),r(" "+n(t.error),1)])):D("",!0)]))),128))])])):(d(),_("div",at,[e(_e,{modelValue:U.value,"onUpdate:modelValue":s[5]||(s[5]=t=>U.value=t),type:"border-card"},{default:a(()=>[e(F,{label:"执行日志",name:"logs"},{default:a(()=>[o("div",lt,[(d(!0),_(N,null,M(p.value.steps,(t,g)=>(d(),_("div",{key:g,class:"log-item"},[o("div",ot,[e(b,{type:t.success?"success":"danger",size:"small"},{default:a(()=>[r(" 步骤 "+n(t.step_number),1)]),_:2},1032,["type"]),o("span",nt,n(L(t.action_type)),1),o("span",rt,n(t.description),1)]),t.error?(d(),_("div",it,[e(k,null,{default:a(()=>[e(C(Y))]),_:1}),r(" "+n(t.error),1)])):D("",!0)]))),128))])]),_:1}),e(F,{label:"失败截图",name:"screenshots"},{default:a(()=>[p.value.screenshots&&p.value.screenshots.length>0?(d(),_("div",dt,[(d(!0),_(N,null,M(p.value.screenshots,(t,g)=>(d(),_("div",{key:g,class:"screenshot-item"},[o("h5",null,n(t.description||`截图 ${g+1}`),1),o("img",{src:t.url,alt:t.description,class:"screenshot-img"},null,8,ct),o("p",ut,n(t.timestamp),1)]))),128))])):(d(),V(W,{key:1,description:"没有截图"}))]),_:1}),e(F,{label:"错误信息",name:"error"},{default:a(()=>[o("div",_t,[p.value.error?(d(),_("div",pt,[o("div",vt,[o("pre",ft,n(p.value.error),1)])])):(d(),V(W,{key:1,description:"没有错误信息"}))])]),_:1})]),_:1},8,["modelValue"])]))])):D("",!0)]),_:1},8,["modelValue","title"])])}}},bt=ve(gt,[["__scopeId","data-v-8b223fb1"]]);export{bt as default};
