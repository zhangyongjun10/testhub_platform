import{_ as J,q as c,V as E,r as d,o as n,c as _,b as o,d as t,w as l,g as m,af as O,f as I,J as C,cN as P,B as Z,cO as j,t as h,L as N,F as K,y as Q,G as W,cP as X,a3 as Y,e as p,M as ee}from"./index-054e2682.js";import{Z as te,_ as le,$ as se,a0 as ae}from"./ui_automation-53e326f9.js";const oe={class:"page-container"},ne={class:"card-container"},ie={key:0,class:"empty-logs"},re={key:1,class:"log-content"},de={class:"task-list-container"},ue={key:0,class:"analyzing-state"},ce={key:1},pe={class:"task-status-icon"},_e={class:"task-content"},fe={class:"task-id"},ve={class:"task-desc"},me={key:2,class:"empty-tasks"},ge={class:"dialog-footer"},ye={__name:"AITesting",setup(ke){const f=c(!1),g=c(!1),F=c(!1),V=c(""),y=c([]),k=c(null),A=c(null),i=E({description:"",enableGif:!0}),b=c(!1),u=E({name:"",description:""}),T=c(null),R={name:[{required:!0,message:"请输入用例名称",trigger:"blur"}]},S=async()=>{var r,e;f.value=!0,g.value=!0,V.value=`正在初始化 AI Agent...
`,y.value=[];try{const s=await te({task_description:i.description,execution_mode:"text",enable_gif:i.enableGif});k.value=s.data.execution_id,p.success("任务开始执行"),z()}catch(s){console.error("执行失败:",s),p.error("执行失败: "+(((e=(r=s.response)==null?void 0:r.data)==null?void 0:e.error)||s.message)),f.value=!1,g.value=!1}},U=async()=>{if(k.value)try{await le(k.value),p.warning("正在停止任务...")}catch(r){console.error("停止失败:",r),p.error("停止失败")}},z=()=>{const r=setInterval(async()=>{if(!k.value){clearInterval(r);return}try{const s=(await se(k.value)).data;V.value=s.logs||"",y.value=s.planned_tasks||[],y.value.length>0&&(g.value=!1),ee(()=>{A.value&&(A.value.scrollTop=A.value.scrollHeight)}),(s.status==="passed"||s.status==="failed"||s.status==="stopped")&&(clearInterval(r),f.value=!1,g.value=!1,s.status==="passed"?p.success("执行成功"):s.status==="stopped"?p.warning("任务已停止"):p.error("执行失败"))}catch(e){console.error("获取日志失败:",e)}},2e3)},q=()=>{b.value=!0,u.name="",u.description=""},D=async()=>{T.value&&await T.value.validate(async r=>{if(r){F.value=!0;try{await ae({name:u.name,description:u.description,task_description:i.description}),p.success("保存成功"),b.value=!1}catch(e){console.error("保存失败:",e),p.error("保存失败")}finally{F.value=!1}}})};return(r,e)=>{const s=d("el-input"),w=d("el-form-item"),L=d("el-switch"),v=d("el-icon"),x=d("el-button"),G=d("el-form"),H=d("el-alert"),B=d("el-col"),M=d("el-row"),$=d("el-dialog");return n(),_("div",oe,[e[17]||(e[17]=o("div",{class:"page-header"},[o("h1",{class:"page-title"},"AI 智能测试")],-1)),o("div",ne,[t(M,{gutter:20},{default:l(()=>[t(B,{span:12},{default:l(()=>[e[11]||(e[11]=o("div",{class:"section-title"},"任务输入",-1)),t(G,{model:i,"label-position":"top"},{default:l(()=>[t(w,{label:"任务描述",required:""},{default:l(()=>[t(s,{modelValue:i.description,"onUpdate:modelValue":e[0]||(e[0]=a=>i.description=a),type:"textarea",rows:10,placeholder:`请用自然语言描述要执行的任务，例如：
1. 访问 https://www.baidu.com
2. 搜索 'TestHub'
3. 点击第一条搜索结果`,maxlength:"2000","show-word-limit":""},null,8,["modelValue"])]),_:1}),t(w,{label:"GIF录制"},{default:l(()=>[t(L,{modelValue:i.enableGif,"onUpdate:modelValue":e[1]||(e[1]=a=>i.enableGif=a),"active-text":"开启","inactive-text":"关闭"},null,8,["modelValue"]),e[6]||(e[6]=o("span",{style:{"margin-left":"10px",color:"#909399","font-size":"12px"}}," 开启后将录制执行过程并生成GIF文件，保存到 ai_agent_history 目录 ",-1))]),_:1,__:[6]}),t(w,null,{default:l(()=>[t(x,{type:"primary",onClick:S,loading:f.value,disabled:!i.description},{default:l(()=>[t(v,null,{default:l(()=>[t(m(O))]),_:1}),e[7]||(e[7]=I(" 开始执行 ",-1))]),_:1,__:[7]},8,["loading","disabled"]),f.value?(n(),C(x,{key:0,type:"danger",onClick:U,disabled:!f.value||g.value},{default:l(()=>[t(v,null,{default:l(()=>[t(m(P))]),_:1}),e[8]||(e[8]=I(" 停止执行 ",-1))]),_:1,__:[8]},8,["disabled"])):Z("",!0),t(x,{type:"success",onClick:q,disabled:!i.description},{default:l(()=>[t(v,null,{default:l(()=>[t(m(j))]),_:1}),e[9]||(e[9]=I(" 保存为用例 ",-1))]),_:1,__:[9]},8,["disabled"])]),_:1})]),_:1},8,["model"]),t(H,{title:"提示",type:"info",closable:!1,style:{"margin-top":"20px"}},{default:l(()=>e[10]||(e[10]=[o("div",null,'AI 模式使用"配置中心-AI智能模式配置"中的模型（如未添加模型，请前往添加）。',-1),o("div",null,"支持中英文任务描述，任务描述越详细，执行效果越好。",-1)])),_:1}),e[12]||(e[12]=o("div",{class:"section-title",style:{"margin-top":"20px"}},"执行日志",-1)),o("div",{class:"log-container",ref_key:"logContainer",ref:A},[!V.value&&!f.value?(n(),_("div",ie," 暂无执行日志 ")):(n(),_("pre",re,h(V.value),1))],512)]),_:1,__:[11,12]}),t(B,{span:12},{default:l(()=>[e[14]||(e[14]=o("div",{class:"section-title"},"任务明细",-1)),o("div",de,[g.value?(n(),_("div",ue,[t(v,{class:"is-loading"},{default:l(()=>[t(m(N))]),_:1}),e[13]||(e[13]=o("span",null,"任务分析中...",-1))])):y.value.length>0?(n(),_("div",ce,[(n(!0),_(K,null,Q(y.value,a=>(n(),_("div",{key:a.id,class:W(["task-item",a.status])},[o("div",pe,[a.status==="completed"?(n(),C(v,{key:0,color:"#67C23A"},{default:l(()=>[t(m(X))]),_:1})):a.status==="in_progress"?(n(),C(v,{key:1,class:"is-loading",color:"#409EFF"},{default:l(()=>[t(m(N))]),_:1})):(n(),C(v,{key:2,color:"#909399"},{default:l(()=>[t(m(Y))]),_:1}))]),o("div",_e,[o("span",fe,h(a.id)+".",1),o("span",ve,h(a.description),1)])],2))),128))])):(n(),_("div",me," 暂无任务 "))])]),_:1,__:[14]})]),_:1})]),t($,{modelValue:b.value,"onUpdate:modelValue":e[5]||(e[5]=a=>b.value=a),title:"保存为 AI 用例",width:"500px"},{footer:l(()=>[o("span",ge,[t(x,{onClick:e[4]||(e[4]=a=>b.value=!1)},{default:l(()=>e[15]||(e[15]=[I("取消",-1)])),_:1,__:[15]}),t(x,{type:"primary",onClick:D,loading:F.value},{default:l(()=>e[16]||(e[16]=[I("保存",-1)])),_:1,__:[16]},8,["loading"])])]),default:l(()=>[t(G,{model:u,rules:R,ref_key:"saveFormRef",ref:T,"label-width":"80px"},{default:l(()=>[t(w,{label:"用例名称",prop:"name"},{default:l(()=>[t(s,{modelValue:u.name,"onUpdate:modelValue":e[2]||(e[2]=a=>u.name=a),placeholder:"请输入用例名称"},null,8,["modelValue"])]),_:1}),t(w,{label:"描述",prop:"description"},{default:l(()=>[t(s,{modelValue:u.description,"onUpdate:modelValue":e[3]||(e[3]=a=>u.description=a),type:"textarea",placeholder:"请输入用例描述"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},xe=J(ye,[["__scopeId","data-v-0edb702e"]]);export{xe as default};
